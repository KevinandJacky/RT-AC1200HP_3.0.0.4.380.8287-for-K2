var g_support_html5=0,g_reload_page=1,m=new lang,g_storage=new myStorage,g_listview=g_storage.get("listview")==void 0?0:g_storage.get("listview"),g_modal_url,g_modal_window_width=200,g_modal_window_height=80,timer_idle,g_show_modal=0,g_time_out=9E5,g_time_count=0,g_select_mode=0,g_select_array,g_upload_mode=0,g_folder_array=null,g_file_array=null,g_opening_uid="",g_on_button_animation=0,g_on_rescan_samba=0,g_rescan_samba_timer=0,g_rescan_samba_count=0,g_aidisk_name="usbdisk",g_enable_aidisk=0,g_support_lan=
["zh-tw","zh-cn","en-us","jp","it","fr","de","br","cz","da","fi","ms","no","pl","es","sv","th","tr","uk","ru"],g_current_locktoken="",g_mouse_x=0,g_mouse_y=0,g_fileview_only=0,g_medialist_mode=0,client=new davlib.DavClient;client.initialize();g_support_html5=window.File&&window.FileReader&&window.FileList&&window.Blob?1:0;
function openImageViewer(d){for(var b=[],a=0;a<g_file_array.length;a++){var e=getFileExt(g_file_array[a].href);(e=="jpg"||e=="jpeg"||e=="png"||e=="gif")&&b.push(g_file_array[a])}if(b.length==0)alert(m.getString("msg_no_image_list"));else{for(a=e=0;a<b.length;a++)d==b[a].href&&(e=a);d="";a=getPageSize();d+='<div id="image_slide_show" class="barousel unselectable" style="height: 0; width: 0; position: fixed; background-color: rgb(0, 0, 0); left: '+a[0]/2+"px; top: "+a[1]/2+'px; z-index: 2999;">';d+=
'<div class="barousel_image">';for(a=0;a<b.length;a++){var c=window.location.protocol+"//"+window.location.host+b[a].href;d+=a==e?'<img src="" path="'+c+'" alt="" class="default"/>':'<img src="" path="'+c+'" alt="" class=""/>'}d+="</div>";d+='<div class="barousel_nav">';d+='<div class="barousel_content transparent" style="display: block; ">';for(a=0;a<b.length;a++)d+='<div class="',a==e&&(d+="default"),d+='" style="display: none; ">',d+='<p class="header">'+b[a].name+"</p>",d+="</div>";d+="</div>";
d+="</div>";d+="</div>";$(d).animate({width:"100%",height:"100%",left:"0px",top:"0px"},200,null,null).appendTo("body");$("#image_slide_show").barousel({navType:2,manualCarousel:1,contentResize:0,startIndex:e});$(".facebook_upload").click(function(){var a=$("div#modalWindow"),b=$(this).attr("file"),c=myencodeURI(b.substring(b.lastIndexOf("/")+1,b.length)),b=b.substring(0,b.lastIndexOf("/")),e=window.location.host;e.indexOf(":")!=-1&&(e=e.substring(0,e.indexOf(":")));e="http://"+e+":"+g_storage.get("http_port")+
"/";client.GSL(b,b,c,0,0,function(b,d,g){b==200&&(b=parseXml(g),b=$(b).find("sharelink").text(),b=e+b,g_modal_url="http://www.efroip.com/efroip/fbtest/fb.html?v="+b+"&b="+mydecodeURI(c)+"&d="+window.location.href,g_modal_window_width=600,g_modal_window_height=320,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text("Upload to Facebook"),a&&a.jqmShow(),$("#image_slide_show").remove())})});$(".picassa_upload").click(function(){var a=$("div#modalWindow"),b=$(this).attr("file"),c=myencodeURI(b.substring(b.lastIndexOf("/")+
1,b.length)),b=b.substring(0,b.lastIndexOf("/")),e=window.location.host;e.indexOf(":")!=-1&&(e=e.substring(0,e.indexOf(":")));e="http://"+e+":"+g_storage.get("http_port")+"/";client.GSL(b,b,c,0,0,function(b,d,g){b==200&&(b=parseXml(g),b=$(b).find("sharelink").text(),b=e+b,g_modal_url="http://www.efroip.com/efroip/google/index.html?v="+b+"&b="+mydecodeURI(c)+"&d="+window.location.href,g_modal_window_width=600,g_modal_window_height=320,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text("Upload to Facebook"),
a&&a.jqmShow(),$("#image_slide_show").remove())})});b=null}}
function openAudioPlayer(d){for(var b=[],a=0;a<g_file_array.length;a++)getFileExt(g_file_array[a].href)=="mp3"&&b.push(g_file_array[a]);if(b.length==0)alert(m.getString("msg_no_image_list"));else{for(var e="",c=0,a=0;a<b.length;a++){var h=b[a].href;d==h&&(c=a);e+=h;a!=b.length-1&&(e+=",")}b=$("div#modalWindow");g_modal_url="/smb/css/audio.html?a="+d+"&alist="+e+"&index="+c+"&s=1";g_modal_window_width=450;g_modal_window_height=160;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_audioplayer"));
b&&b.jqmShow()}}
function openLoginWindow(d){var b=$("div#modalWindow"),a=b.css("display"),e=function(){var a=$("#table_login input#username").val(),b=$("#table_login input#password").val(),a="Basic "+Base64.encode(a+":"+b);closeJqmWindow(0);doLOGIN(d,a)};g_modal_url="";g_modal_window_width=380;g_modal_window_height=120;if(d=="/")$("#jqmTitleText").text(m.getString("title_login")+" - AiCloud");else{var c=mydecodeURI(d);$("#jqmTitleText").text(m.getString("title_login")+" - "+c.substring(0,35))}a=="block"&&$("#jqmMsgText").text(m.getString("msg_passerror"));
$("#jqmMsg").css("display",a);a="";a+='<table id="table_login" width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="overflow:hidden;">';a+="<tr>";a+="<td>";a+='<form name="form_login">';a+='<fieldset width="120px">';a+="<table>";a+="<tr>";a+='<td><label id="username">'+m.getString("title_username")+'</label></td><td><input name="username" type="text" id="username" autocapitalize="off" style="width:250px"></td>';a+="</tr>";a+="<tr>";a+='<td><label id="password">'+
m.getString("title_password")+'</label></td><td><input name="password" type="password" id="password" style="width:250px"></td>';a+="</tr>";a+="</table>";a+="</fieldset>";a+="</form>";a+="</td>";a+="</tr>";a+='<tr style="height:10px"></tr>';a+="<tr>";a+="<td>";a+='<div class="table_block_footer" style="text-align:right">';a+='<button id="ok" class="btnStyle">'+m.getString("btn_ok")+"</button>";a+='<button id="cancel" class="btnStyle">'+m.getString("btn_cancel")+"</button>";a+="</div>";a+="</td>";a+=
"</tr>";a+="</table>";$("#jqmContent").empty();$(a).appendTo($("#jqmContent"));$("#table_login input#password").keydown(function(a){a.keyCode==13&&e()});$("#table_login #ok").click(function(){e()});$("#table_login #cancel").click(function(){closeJqmWindow(0)});b&&b.jqmShow()}
function doRescanSamba(){var d=addPathSlash(g_storage.get("openurl"));closeJqmWindow(0);showHideLoadStatus(!0);client.RESCANSMBPC(d,function(b){b[0]==2&&(g_storage.setl("onRescanSamba",1),g_storage.setl("onRescanSambaCount",0),g_storage.set("HostList",""),doPROPFIND("/"))})}
function doMKDIR(d){var b=addPathSlash(g_storage.get("openurl")),a=b+myencodeURI(d),e=0;$("a#list_item").each(function(){$(this).attr("isdir")=="1"&&d==$(this).attr("title")&&(e=1,alert(m.getString("folder_already_exist_msg")))});e!=1&&client.MKCOL(a,function(a){a[0]==2?(doPROPFIND(b),closeJqmWindow(0)):alert(m.getString(a))})}
function doRENAME(d,b){var a=0,e=addPathSlash(g_storage.get("openurl")),c=e+b;$("a#list_item").each(function(){b==myencodeURI($(this).attr("title"))&&(a=1,$(this).attr("isdir")=="1"?alert(m.getString("folder_already_exist_msg")):alert(m.getString("file_already_exist_msg")))});a!=1&&client.LOCK(d,"",function(a,b,f){if(a!="201")alert(m.getString("msg_already_lock"));else{var j=getLockToken(f);client.MOVE(d,c,function(a){a[0]==2?(doPROPFIND(e),closeJqmWindow(0)):alert(m.getString(a));client.UNLOCK(d,
j,function(a){a!=204&&alert("Unlock error: "+a)})},null,"F",j)}},null)}function getFileViewHeight(){return $("#fileview").height()}function closePopupmenu(){$(".popupmenu").remove()}function confirmCancelUploadFile(){if(g_storage.get("isOnUploadFile")==1){if(confirm(m.getString("msg_confirm_cancel_upload"))!=!0)return 0;$("#upload_panel iframe")[0].contentWindow.stop_upload()}return 1}
function closeUploadPanel(d){g_upload_mode=0;g_reload_page=d;g_storage.set("stopLogoutTimer","0");$("div#btnNewDir").css("display","block");$("div#btnUpload").css("display","block");$("div#btnSelect").css("display","block");$("div#btnPlayImage").css("display","block");$("div#btnCancelUpload").css("display","none");$("#function_help").text("");$("#upload_panel").animate({left:"1999px"},"slow",null,function(){$("#upload_panel").css("display","none");adjustLayout()});d==1&&(d=addPathSlash(g_storage.get("openurl")),
doPROPFIND(d))}
function cancelSelectMode(){g_select_mode!=0&&(g_select_mode=0,g_select_array=null,$("#btnDownload").addClass("disable"),$("#btnShareLink").addClass("disable"),$("#btnDeleteSel").addClass("disable"),$("#btnRename").addClass("disable"),g_medialist_mode==1?($("div#btnNewDir").css("display","none"),$("div#btnUpload").css("display","none"),$("div#btnSelect").css("display","block"),$("div#btnPlayImage").css("display","block"),$("div#boxSearch").css("display","block")):($("div#btnNewDir").css("display","block"),
$("div#btnUpload").css("display","block"),$("div#btnSelect").css("display","block"),$("div#btnPlayImage").css("display","block"),$("div#boxSearch").css("display","none")),$("div#btnCancelSelect").css("display","none"),$(".selectDiv").css("display","none"),$(".selectHintDiv").css("display","none"),$("#fileview #fileviewicon").each(function(){$(this).removeClass("select")}),$("#function_help").text(""),adjustLayout(),$("#button_panel").animate({left:"1999px"},"slow",null,function(){}))}
function adjustLayout(){var d=getPageSize(),b=d[0],a=d[1]-$("#header_region").height()-$("#bottom_region").height();$("#main_region").css("height",a);d=d[0];$("#main_region #main_right_region").css("width",d-$("#main_region #main_left_region").width());d=$("#main_left_region").height()-$("#infobar").height()-$("#settingbar").height();a=Math.max(Math.floor(d/40),1)*40;$("#hostview").css("height",a);$("#settingbar").css("padding-top",d-a);var e=0;$("#toolbar .albutton").each(function(){$(this).css("display")==
"block"&&(e+=$(this).width())});$("#toolbar .alsearch").css("display")=="block"&&(e+=$("#toolbar .alsearch").width());$("#urlregion-url").css("width",$("#toolbar").width()-e-20);createOpenUrlUI(g_storage.get("openurl"));d=g_select_mode==1?$("#main_right_container").height()-$("#infobar").height()-$("#button_panel").height():$("#main_right_container").height()-$("#infobar").height();$("#fileview").css("height",d);$("#function_help").css("left",$("#main_left_region").width());(d=$("div#modalWindow"))&&
d.css("left",(b-g_modal_window_width)/2)}function closeJqmWindow(d){g_reload_page=d;d=$("div#modalWindow");$("iframe",d).attr("src","");d&&d.jqmHide();showHideLoadStatus(!1)}function resizeJqmWindow(d,b){var a=$(".jqmWindow");a&&(a.css("width",d+"px"),a.css("height",b+"px"))}function fullscreenJqmWindow(){var d=$("div#modalWindow");d&&(d.css("left","0px"),d.css("top","0px"),d.css("width",window.width+"px"),d.css("height",window.height+"px"))}
function doLOGOUT(){doPROPFIND("/",function(){addPathSlash(g_storage.get("openurl"));client.LOGOUT("/",function(d){d[0]==2&&(g_storage.set("openhostuid","0"),window.location.reload())})},0)}function resetTimer(){clearInterval(timer_idle);g_time_count=0;timer_idle=setInterval(function(){g_storage.get("stopLogoutTimer")=="1"||g_show_modal==1?g_time_count=0:(g_time_count++,g_time_count*1E3>g_time_out&&(g_time_count=0,doLOGOUT()))},1E3)}
function createOpenUrlUI(d){d==void 0&&(d="/");var b=mydecodeURI(d),a="",e="",c="",h=$("#urlregion-url").width();if(b!="/")for(var b=b.split("/"),d=d.split("/"),g=0;g<b.length;g++)if(!(b[g]==""||g_enable_aidisk==1&&b[g]==g_aidisk_name)){e+="/"+d[g];c+=" / <a id='url_path' uhref='"+e+"'>"+b[g]+"</a>";if(String(c).width($("p#openurl").css("font"))>h){a+=" / ...";break}a+=b[1]==g_aidisk_name&&g_enable_aidisk==1?" / <a id='url_path' uhref='/"+g_aidisk_name+e+"'>"+b[g]+"</a>":" / <a id='url_path' uhref='"+
e+"'>"+b[g]+"</a>";c=a}$("p#openurl").empty();$("p#openurl").append(a);$("a#url_path").click(function(){confirmCancelUploadFile()!=0&&doPROPFIND($(this).attr("uhref"))})}
function doPROPFINDMEDIALIST(d,b,a,e,c,h,g,f,j){if(client!=null){showHideLoadStatus(!0);try{client.PROPFINDMEDIALIST(d,function(c,h,k){if(c){if(c==207){if(cancelSelectMode(),closeUploadPanel(),h=content2XMLDOM(k)){c=parseInt(h.documentElement.getAttribute("qcount"));parseInt(h.documentElement.getAttribute("qstart"));k=parseInt(h.documentElement.getAttribute("qend"));parserPropfindXML(h,d,b);createThumbView(1,"",g_folder_array,g_file_array);if(c>k){k+=1;h=k+50;h>c&&(h=c);var k="<div class='nextDiv' start='"+
k+"' end='"+h+"'><span>",l=m.getString("title_next_query"),l=l.replace("%s",h),l=l.replace("%s",c);k+=l;k+="</span></div>";$("#main_right_container #fileview").append(k);$(".nextDiv").click(function(){doPROPFINDMEDIALIST(d,!0,null,e,$(this).attr("start"),$(this).attr("end"),g,f,j)})}g_medialist_mode=1;$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","block");$("div#btnNewDir").css("display","none");$("div#btnPlayImage").css("display","block");$("div#boxSearch").css("display",
"block");g_storage.set("openurl",d);$("div#hostview").scrollTop(g_storage.get("hostviewscrollTop"));$("div#fileview").scrollLeft(g_storage.get("contentscrollLeft"));$("div#fileview").scrollTop(g_storage.get("contentscrollTop"));$("div#boxSearch").attr("uhref",d);$("div#boxSearch").attr("qtype",e);adjustLayout();closeJqmWindow(0);a!=void 0&&a()}}else c==501?doPROPFINDMEDIALIST(d):c==401?setTimeout(openLoginWindow(d),2E3):alert(m.getString(c));showHideLoadStatus(!1)}},null,e,c,h,g,f,j),resetTimer()}catch(k){alert("catch error: "+
k)}}}
function parserPropfindXML(d,b,a){if(d){a==!1&&(g_file_array=g_folder_array=null);g_folder_array==null&&(g_folder_array=[]);g_file_array==null&&(g_file_array=[]);for(var e,c,h,g=d.documentElement.childNodes,d=0;d<g.length;d++){var f="",j="",k="",p="",s="",r="",l="",u="",v="",w="",x="",y="",z="",A;h="";for(var B="0",q="",n=g[d].childNodes,a=0;a<n.length;a++)if(n[a].nodeType==1&&n[a].nodeName=="D:propstat"){var t=n[a].childNodes;for(e=0;e<t.length;e++)if(t[e].nodeName=="D:prop"){var i=t[e].childNodes;for(c=
0;c<i.length;c++)if(!(i[c].childNodes.length<=0))if(i[c].nodeName=="D:getcontenttype")j=String(i[c].childNodes[0].nodeValue);else if(i[c].nodeName=="D:getuniqueid")k=String(i[c].childNodes[0].nodeValue);else if(i[c].nodeName=="D:getonline")r=String(i[c].childNodes[0].nodeValue);else if(i[c].nodeName=="D:getlastmodified")l=String(i[c].childNodes[0].nodeValue);else if(i[c].nodeName=="D:getcontentlength")u=String(size_format(parseInt(i[c].childNodes[0].nodeValue)));else if(i[c].nodeName=="D:getmac")w=
String(i[c].childNodes[0].nodeValue);else if(i[c].nodeName=="D:getip")v=String(i[c].childNodes[0].nodeValue);else if(i[c].nodeName=="D:gettype")x=String(i[c].childNodes[0].nodeValue);else if(i[c].nodeName=="D:getattr"){var o=i[c].childNodes;for(h=0;h<o.length;h++)if(o[h].nodeName=="D:readonly")y=o[h].childNodes[0].nodeValue;else if(o[h].nodeName=="D:hidden")z=o[h].childNodes[0].nodeValue}else if(i[c].nodeName=="D:getuseragent")h=String(i[c].childNodes[0].nodeValue),g_storage.set("user_agent",h);else if(i[c].nodeName==
"D:getroutersync")B=String(i[c].childNodes[0].nodeValue);else if(i[c].nodeName=="D:getmatadata"){o=i[c].childNodes;for(h=0;h<o.length;h++)if(o[h].nodeName=="D:title")q=o[h].childNodes[0].nodeValue}}}else n[a].nodeType==1&&n[a].nodeName=="D:href"&&(f=String(n[a].childNodes[0].nodeValue),e="",f.match(/^http/)&&(e=window.location.protocol+"//"+window.location.host),c=e+addPathSlash(b),f!=c?(f=f.replace(e,""),p=f.substring(f.lastIndexOf("/")+1,f.length),p!=""?(A=p,s=p=mydecodeURI(p),e=g_listview==0?12:
45,s.length>e&&(s=s.substring(0,e)+"...")):f=""):f="");f!=""&&(j=="httpd/unix-directory"?g_folder_array.push({contenttype:j,href:f,name:p,uname:A,shortname:s,online:r,time:l,size:u,ip:v,mac:w,uid:k,type:x,freadonly:y,fhidden:z,routersyncfolder:B,matadatatitle:q}):g_file_array.push({contenttype:j,href:f,name:p,uname:A,shortname:s,online:r,time:l,size:u,ip:v,mac:w,uid:k,type:x,freadonly:y,fhidden:z,routersyncfolder:B,matadatatitle:q}))}}}
function content2XMLDOM(d){if(d=="")return null;var b=null,b=null;if(window.DOMParser)b=new DOMParser,b=b.parseFromString(d,"text/xml");else if(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(d),!b.documentElement)return alert("Fail to load xml!"),showHideLoadStatus(!1),null;return b}
function doPROPFIND(d,b,a){if(client!=null){showHideLoadStatus(!0);try{client.PROPFIND(d,a,function(a,e,g){if(a){if(a==207){cancelSelectMode();closeUploadPanel();var f=content2XMLDOM(g);if(f){a=f.documentElement.getAttribute("qtype");f.documentElement.getAttribute("readonly");e=f.documentElement.getAttribute("ruser");f.documentElement.getAttribute("computername");g=f.documentElement.getAttribute("isusb");parserPropfindXML(f,d,!1);g_folder_array.sort(sortByName);g_file_array.sort(sortByName);for(f=
0;f<g_folder_array.length;f++)g_folder_array[f].type=="usbdisk"&&arraymove(g_folder_array,f,0);f=addPathSlash(d);f!="/"&&(f=f.substring(0,f.length-1),f=f.substring(0,f.lastIndexOf("/")),f==""&&(f="/"));createHostList(a,g_folder_array);createThumbView(a,f,g_folder_array,g_file_array);g_medialist_mode=0;a==0&&g_select_mode==0?($("div#btnUpload").css("display","block"),$("div#btnSelect").css("display","block"),$("div#btnNewDir").css("display","block"),$("div#btnPlayImage").css("display","block")):($("div#btnUpload").css("display",
"none"),$("div#btnSelect").css("display","none"),$("div#btnNewDir").css("display","none"),$("div#btnPlayImage").css("display","none"));$("div#boxSearch").css("display","none");$("div#boxSearch input").val("");g_select_mode==1&&$("#btnCancelSelect").css("display","block");g_upload_mode==1&&$("#btnCancelUpload").css("display","block");a==1&&g==0?$("#btnChangeUser").css("display","block"):$("#btnChangeUser").css("display","none");$("span#username").text(e);g_storage.set("openurl",d);$("div#hostview").scrollTop(g_storage.get("hostviewscrollTop"));
$("div#fileview").scrollLeft(g_storage.get("contentscrollLeft"));$("div#fileview").scrollTop(g_storage.get("contentscrollTop"));adjustLayout();closeJqmWindow(0);b!=void 0&&b()}}else a==501?doPROPFIND(d):a==401?setTimeout(openLoginWindow(d),2E3):alert(m.getString(a));showHideLoadStatus(!1)}},null,1),resetTimer()}catch(e){alert("catch error: "+e)}}}
function registerPage(d){if(!(d!="/"||isPrivateIP(g_storage.get("wan_ip"))))d=g_storage.get("ddns_host_name"),d==""?alert("start ddns process"):window.location="http://140.130.25.39/aicloud?v=https://"+d}function doLOGIN(d,b){doPROPFIND(d,function(){g_opening_uid!=""&&(g_storage.set("openhostuid",g_opening_uid),$("#hostview .host_item").each(function(){$(this).attr("uid")==g_opening_uid?$(this).addClass("select"):$(this).removeClass("select")}),g_opening_uid="")},b)}
function refreshHostList(){if(client!=null)try{client.PROPFIND("/",null,function(b,a,e){if(b&&b==207){var c,b=[];if(window.DOMParser)a=new DOMParser,c=a.parseFromString(e,"text/xml");else if(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(e),!c.documentElement){alert("Fail to load xml!");showHideLoadStatus(!1);return}var d,g,f,j,a=c.documentElement.childNodes,e=c.documentElement.getAttribute("qtype");c.documentElement.getAttribute("readonly");c.documentElement.getAttribute("ruser");
c.documentElement.getAttribute("computername");c.documentElement.getAttribute("isusb");for(c=0;c<a.length;c++){var k="",p="",s="",r="",l="",u="",v="",w="",x="",y="",z="",A="",B="",q,n=a[c].childNodes;for(d=0;d<n.length;d++)if(n[d].nodeType==1&&n[d].nodeName=="D:propstat"){var t=n[d].childNodes;for(g=0;g<t.length;g++)if(t[g].nodeName=="D:prop"){var i=t[g].childNodes;for(f=0;f<i.length;f++)if(!(i[f].childNodes.length<=0))if(i[f].nodeName=="D:getcontenttype")p=String(i[f].childNodes[0].nodeValue);else if(i[f].nodeName==
"D:getuniqueid")s=String(i[f].childNodes[0].nodeValue);else if(i[f].nodeName=="D:getonline")u=String(i[f].childNodes[0].nodeValue);else if(i[f].nodeName=="D:getlastmodified")v=String(i[f].childNodes[0].nodeValue);else if(i[f].nodeName=="D:getcontentlength")w=String(size_format(parseInt(i[f].childNodes[0].nodeValue)));else if(i[f].nodeName=="D:getmac")y=String(i[f].childNodes[0].nodeValue);else if(i[f].nodeName=="D:getip")x=String(i[f].childNodes[0].nodeValue);else if(i[f].nodeName=="D:gettype")z=
String(i[f].childNodes[0].nodeValue);else if(i[f].nodeName=="D:getattr"){var o=i[f].childNodes;for(j=0;j<o.length;j++)if(o[j].nodeName=="D:readonly")A=o[j].childNodes[0].nodeValue;else if(o[j].nodeName=="D:hidden")B=o[j].childNodes[0].nodeValue}}}else n[d].nodeType==1&&n[d].nodeName=="D:href"&&(k=String(n[d].childNodes[0].nodeValue),g="",k.match(/^http/)&&(g=window.location.protocol+"//"+window.location.host),f=g+addPathSlash("/"),k!=f?(k=k.replace(g,""),r=k.substring(k.lastIndexOf("/")+1,k.length),
r!=""?(q=r,l=r=mydecodeURI(r),g=g_listview==0?12:45,l.length>g&&(l=l.substring(0,g)+"...")):k=""):k="");k!=""&&p=="httpd/unix-directory"&&b.push({contenttype:p,href:k,name:r,uname:q,shortname:l,online:u,time:v,size:w,ip:x,mac:y,uid:s,type:z,freadonly:A,fhidden:B})}b.sort(sortByName);for(q=0;q<b.length;q++)b[q].type=="usbdisk"&&arraymove(b,q,0);createHostList(e,b)}},null,1)}catch(d){alert("catch error: "+d)}}
function createHostList(d,b){var a="";$("#hostview").empty();var e=g_storage.get("HostList")?g_storage.get("HostList").split(/,/):[],c=g_storage.getl("onRescanSamba"),h=g_storage.getl("onRescanSambaCount");if(d==2)for(var g=0;g<b.length;g++){var f=b[g].href+"|"+b[g].name+"|"+b[g].online+"|"+b[g].ip+"|"+b[g].mac+"|"+b[g].uid+"|"+b[g].freadonly+"|"+b[g].fhidden+"|"+b[g].type;e.contains(f)||e.push(f);g_storage.set("HostList",e.join(","))}for(g=0;g<e.length;g++)f=e[g].split("|"),a+="<div class='host_item unselectable",
f[2]==0&&(a+=" offline"),a+="' uhref='",a+=f[0],a+="' title='",a+=f[1]+" - "+f[3],a+="' online='",a+=f[2],a+="' isdir='1'",a+=" ip='",a+=f[3],a+="' mac='",a+=f[4],a+="' uid='",a+=f[5],a+="' freadonly='",a+=f[6],a+="' fhidden='",a+=f[7],a+=f[8]=="usbdisk"?"' isusb='1'":"' isusb='0'",a+=">",a+="<div id='hosticon' class='sicon "+f[8],f[2]==0&&(a+="off"),a+="'/>",a+="<div id='hostname' class='unselectable'>",a+="<p>",a+=f[1],f[2]==0&&(a+="("+m.getString("title_offline")+")"),a+="</p>",a+="</div>",a+=
"</div>";c==1&&(a+="<div class='scan_item unselectable rescan'>",a+="<div id='hosticon' class='sicon sambapcrescan'/>",a+="<div id='scanlabel' class='unselectable'>",a+="<p>"+m.getString("title_scan"),a+="</p>",a+="</div>",a+="</div>",g_rescan_samba_timer==0&&(g_rescan_samba_timer=setInterval(function(){h++;h>=10?(clearInterval(g_rescan_samba_timer),g_storage.setl("onRescanSamba",0),g_storage.setl("onRescanSambaCount",0)):g_storage.setl("onRescanSambaCount",h);refreshHostList()},5E3)));$("#hostview").append(a);
var j=g_storage.get("openhostuid");$("#hostview .host_item").each(function(){$(this).attr("uid")==j?$(this).addClass("select"):$(this).removeClass("select")});$("#hostview .host_item").click(function(){if(confirmCancelUploadFile()!=0)if($(this).attr("online")==0)confirm(m.getString("wol_msg"))==!0&&client.WOL("/",$(this).attr("mac"),function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))});else{g_opening_uid=$(this).attr("uid");var a=$(this).attr("uhref");g_storage.set("opentype",
$(this).attr("type")=="usbdisk"?"1":"0");doPROPFIND(a,function(){g_storage.set("openhostuid",g_opening_uid);$("#hostview .host_item").each(function(){$(this).attr("uid")==g_opening_uid?$(this).addClass("select"):$(this).removeClass("select")});g_opening_uid=""},null)}})}
function createThumbView(d,b,a,e){var c="";$("#main_right_container #fileview").empty();if(d!=2){d==0&&(c+='<div class="albumDiv">',c+='<table class="thumb-table-parent">',c+="<tbody>",c+="<tr><td>",c+='<div class="picDiv cb" isParent="1" popupmenu="0" uhref="',c+=b,c+='">',c+='<div class="parentDiv bicon"></div></div>',c+="</td></tr>",c+="<tr><td>",c+='<div class="albuminfo">',c+='<a id="list_item" qtype="1" isdir="1" uhref="',c+=b,c+='" title="'+m.getString("btn_prevpage")+'" online="0">'+m.getString("btn_prevpage"),
c+="</a>",c+="</div>",c+="</td></tr>",c+="</tbody>",c+="</table>",c+="</div>");for(b=0;b<a.length;b++){var h=m.getString("table_filename")+": "+a[b].name;a[b].time!=""&&(h+="\n"+m.getString("table_time")+": "+a[b].time);c+='<div class="albumDiv" ';c+=' title="';c+=h;c+='">';c+='<table class="thumb-table-parent">';c+="<tbody>";c+="<tr><td>";c+='<div class="picDiv cb" popupmenu="';c+=d=="0"?"1":"0";c+='" uhref="';c+=a[b].href;c+='">';c+=d=="2"?a[b].type=="usbdisk"?'<div id="fileviewicon" class="usbDiv bicon">':
a[b].online=="1"?'<div id="fileviewicon" class="computerDiv bicon">':'<div id="fileviewicon" class="computerOffDiv bicon">':'<div id="fileviewicon" class="folderDiv bicon">';a[b].routersyncfolder=="1"&&(c+='<div id="routersyncicon" class="routersyncDiv sicon"></div>');c+='<div class="selectDiv sicon"></div>';c+='<div class="selectHintDiv sicon"></div>';c+="</div></div>";c+="</td></tr>";c+="<tr><td>";c+='<div class="albuminfo">';c+='<a id="list_item" qtype="';c+=d;c+='" isdir="1" uhref="';c+=a[b].href;
c+='" title="';c+=a[b].name;c+='" online="';c+=a[b].online;c+='" ip="" mac="';c+=a[b].mac;c+='" uid="';c+=a[b].uid;c+='" freadonly="';c+=a[b].freadonly;c+='" fhidden="';c+=a[b].fhidden;c+=a[b].type=="usbdisk"?'" isusb="1"':'" isusb="0"';c+='">';c+=a[b].shortname;a[b].online=="0"&&d=="2"&&(c+="("+m.getString("title_offline")+")");c+="</a>";c+="</div>";c+="</td></tr>";c+="</tbody>";c+="</table>";c+="</div>";a[b].type=="usbdisk"&&d==1&&g_fileview_only==0&&client.GETDISKSPACE("/",a[b].name,function(a,
b,c){a==200&&(a=parseXml(c),b=$(a),a=$('a#list_item[title="'+b.find("DiskName").text()+'"]').parents(".albumDiv"),b=a.attr("title")+"\n"+m.getString("table_diskusedpercent")+": "+b.find("DiskUsedPercent").text(),a.attr("title",b))})}for(b=0;b<e.length;b++)h=m.getString("table_filename")+": "+e[b].name+"\n"+m.getString("table_time")+": "+e[b].time+"\n"+m.getString("table_size")+": "+e[b].size,c+='<div class="albumDiv"',c+=' title="',c+=h,c+='">',c+='<table class="thumb-table-parent">',c+="<tbody>",
a=getFileExt(String(e[b].href)),a.length>5&&(a=""),c+="<tr><td>",c+=d=="0"?'<div class="picDiv cb" popupmenu="1" uhref="':'<div class="picDiv cb" popupmenu="0" uhref="',c+=e[b].href,c+='">',c+=a=="jpg"||a=="jpeg"||a=="png"||a=="gif"||a=="bmp"?'<div id="fileviewicon" class="imgfileDiv bicon">':a=="mp3"||a=="m4a"||a=="m4r"||a=="wav"?'<div id="fileviewicon" class="audiofileDiv bicon">':a=="mp4"||a=="rmvb"||a=="m4v"||a=="wmv"||a=="avi"||a=="mpg"||a=="mpeg"||a=="mkv"||a=="mov"||a=="flv"||a=="3gp"||a==
"m2v"||a=="rm"?'<div id="fileviewicon" class="videofileDiv bicon">':a=="doc"||a=="docx"?'<div id="fileviewicon" class="docfileDiv bicon">':a=="ppt"||a=="pptx"?'<div id="fileviewicon" class="pptfileDiv bicon">':a=="xls"||a=="xlsx"?'<div id="fileviewicon" class="xlsfileDiv bicon">':a=="pdf"?'<div id="fileviewicon" class="pdffileDiv bicon">':'<div id="fileviewicon" class="fileDiv bicon">',c+='<div class="selectDiv sicon"></div>',c+='<div class="selectHintDiv sicon"></div>',c+="</div></div>",c+="</td></tr>",
c+="<tr><td>",c+='<div class="albuminfo" style="font-size:80%">',c+='<a id="list_item" qtype="1" isdir="0" uhref="',c+=e[b].href,c+='" title="',c+=e[b].name,c+='" matadatatitle="',c+=e[b].matadatatitle,c+='" uid="',c+=e[b].uid,c+='" ext="',c+=a,c+='" freadonly="',c+=e[b].freadonly,c+='" fhidden="',c+=e[b].fhidden,c+='">',c+=e[b].shortname,c+="</a>",c+="</div>",c+="</td></tr>",c+="</tbody>",c+="</table>",c+="</div>";$("#main_right_container #fileview").append(c);$(".cb").mousedown(onMouseDownPicDIVHandler)}}
function sortByName(d,b){var a=d.name.toLowerCase(),e=b.name.toLowerCase();return a<e?-1:a>e?1:0}function arraymove(d,b,a){var e=d[b];d.splice(b,1);d.splice(a,0,e)}function showHideLoadStatus(d){d?$("#loading").css("display","block"):$("#loading").css("display","none")}
function onMouseDownPicDIVHandler(d){if(d.button==2||g_on_button_animation==1)return!1;if(g_select_mode==1)if($(this).attr("isParent")==1)cancelSelectMode(),openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"));else{$(this).find(".selectDiv").css("display")=="none"?($(this).find(".selectDiv").css("display","block"),$(this).find(".selectHintDiv").css("display","none")):($(this).find(".selectDiv").css("display","none"),$(this).find(".selectHintDiv").css("display","block"));g_select_array=
null;g_select_array=[];var b=0,a=0;$("#fileview").find(".albumDiv").each(function(){if($(this).find(".selectDiv").css("display")=="block"){var e=$(this).find("#list_item").attr("uhref"),c=$(this).find("#list_item").attr("isdir"),d=myencodeURI($(this).find("#list_item").attr("title"));c==1?a++:b++;g_select_array.push({isdir:c,uhref:e,title:d})}});g_medialist_mode==0&&(b>0||a>0?($("#btnDeleteSel").removeClass("disable"),$("#btnDownload").removeClass("disable"),$("#btnShareLink").removeClass("disable")):
($("#btnDeleteSel").addClass("disable"),$("#btnDownload").addClass("disable"),$("#btnShareLink").addClass("disable")),b+a==1?$("#btnRename").removeClass("disable"):$("#btnRename").addClass("disable"))}else openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"))}
function openSelItem(d){var b=d.attr("uhref"),a=d.attr("qtype"),e=d.attr("isdir"),c=d.attr("isusb"),h=d.attr("uhref"),g=d.attr("title");g_storage.set("openuid",d.attr("uid"));g_storage.set("opentype",c);if(a==2&&d.attr("online")==0)confirm(m.getString("wol_msg"))==!0&&(d=d.attr("mac"),client.WOL("/",d,function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))}));else if(e=="1")doPROPFIND(b,null,null);else{a=getFileExt(b);e=g_storage.get("webdav_mode");if(a=="mp4"||a=="m4v"||
a=="wmv"||a=="avi"||a=="rmvb"||a=="rm"||a=="mpg"||a=="mpeg"||a=="mkv"||a=="mov"||a=="flv")if((e==0||e==2)&&isWinOS())if(isBrowser("msie")&&getInternetExplorerVersion()<=7)alert(m.getString("msg_vlcsupport"));else{var f=$("div#modalWindow"),g=myencodeURI(g);this_url=h.substring(0,h.lastIndexOf("/"));var j=window.location.host;j.indexOf(":")!=-1&&(j=j.substring(0,j.indexOf(":")));var j="http://"+j+":"+g_storage.get("http_port")+"/",k=d.attr("matadatatitle");client.GSL(this_url,this_url,g,0,0,function(a,
b,c){a==200&&(a=parseXml(c),a=$(a).find("sharelink").text(),b="",a=j+a,b="/smb/css/vlc_video.html?v="+a,b+="&t="+k,b+="&showbutton=1",g_modal_url=b,g_modal_window_width=655,g_modal_window_height=500,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_videoplayer")),f&&f.jqmShow())});return}if(a=="mp3")openAudioPlayer(b);else{if(a=="doc"||a=="docx"||a=="ppt"||a=="pptx"||a=="xls"||a=="xlsx"||a=="pdf")if((isWinOS()||isMacOS())&&!isPrivateIP()){g=myencodeURI(g);this_url=h.substring(0,
h.lastIndexOf("/"));client.GSL(this_url,this_url,g,0,0,function(a,b,c){a==200&&(a=parseXml(c),a=$(a).find("sharelink").text(),b="",a=window.location.protocol+"//"+window.location.host+"/"+a,window.open("https://docs.google.com/viewer?url="+a))});return}a=="jpg"||a=="jpeg"||a=="png"||a=="gif"?openImageViewer(b):window.open(b)}}}
function createLayout(){var d=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),d=g_storage.get("lan")==void 0?d:g_storage.get("lan"),d=m.setLanguage(d);$("body").attr("openurl")!=void 0&&g_storage.set("openurl",$("body").attr("openurl"));$("body").attr("fileview_only")!=void 0&&(g_fileview_only=$("body").attr("fileview_only"));var b="";b+="<div id='header_region' class='unselectable' width='100%' border='0'>";b+="<div id='logo'></div>";g_fileview_only==0&&(b+="<div id='user'>Welcome home, <span id='username'></span><span id='login_info'></span>",
b+="</div>");b+="<div id='loading'><img src='/smb/css/load.gif'/><div><span>Loading...</span></div></div>";b+="<ul class='navigation' id='lan'>";b+="<li>";b+="<dl>";b+="<dt><a id='"+d+"'>"+m.getString("lan_"+d)+"</a></dt>";for(var a=0;a<g_support_lan.length;a++)g_support_lan[a]!=d&&(b+="<dd><a id='"+g_support_lan[a]+"'>"+m.getString("lan_"+g_support_lan[a])+"</a></dt>");b+="</dl>";b+="</li>";b+="<ul>";b+="</div>";b+="<div id='main_region' class='unselectable'>";b+="<div style='width: 100%;height:100%;float:left;position: relative;'>";
g_fileview_only==0?(b+="<div id='main_left_region' class='unselectable'>",b+="<div id='infobar' class='unselectable'></div>",b+="<div id='hostview' class='unselectable'></div>"):b+="<div id='main_left_region' class='unselectable hidehostview'>";b+="</div>";b+="<div id='main_right_region' class='unselectable'>";b+="<div id='main_right_container' class='unselectable'>";b+="<div id='infobar' class='unselectable'>";b+="<div id='toolbar' class='unselectable'>";b+="<div id='urlregion-url'>";b+="<p id='openurl' align='left' width='150' style='padding-left:10px' ></p>";
b+="</div>";g_fileview_only==0&&(b+="<div class='alsearch toolbar-button-right' id='boxSearch' style='display:none'><input type='text'/></div>",b+="<div class='albutton toolbar-button-right' id='btnUpload' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnPlayImage' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnNewDir' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnSelect' style='display:none'><div class='ticon'></div></div>",
b+="<div class='albutton toolbar-button-right' id='btnCancelSelect' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnCancelUpload' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnChangeUser' style='display:none'><div class='ticon'></div></div>");b+="</div>";b+="</div>";b+="<div id='fileview' class='unselectable'></div>";b+="<div id='button_panel' class='unselectable'>";b+="<div class='abbutton toolbar-button-right disable' id='btnShareLink' style='display:block'><div class='ticon'></div></div>";
b+="<div class='abbutton toolbar-button-right disable' id='btnDeleteSel' style='display:block'><div class='ticon'></div></div>";b+="<div class='abbutton toolbar-button-right disable' id='btnDownload' style='display:block'><div class='ticon'></div></div>";b+="<div class='abbutton toolbar-button-right disable' id='btnRename' style='display:block'><div class='ticon'></div></div>";b+="</div>";b+="<div id='upload_panel' class='unselectable'>";b+="<div style='position:absolute;width:98%;height:100%;padding:10px'>";
b+="<iframe src='' width='100%' height='100%' frameborder='0'/>";b+="</div>";b+="</div>";b+="</div>";b+="</div>";b+="</div>";b+="</div>";b+="<div id='bottom_region' class='unselectable'>";g_fileview_only==0&&(b+="<ul class='navigation' id='setting'>",b+="<li>",b+="<dl>",b+="<dd><a id='help'>"+m.getString("title_help")+"</a></dt>",b+="<dd><a id='version'>"+m.getString("title_version")+"</a></dt>",b+="<dd><a id='sharelink'>"+m.getString("title_sharelink")+"</a></dt>",b+="<dd><a id='rescan_samba'>"+
m.getString("title_rescan")+"</a></dt>",b+="<dd><a id='config'>"+m.getString("btn_config")+"</a></dt>",b+="<dd><a id='favorite'>"+m.getString("btn_favorite")+"</a></dt>",b+="<dd><a id='logout'>"+m.getString("title_logout")+"</a></dt>",b+="<dt><a>"+m.getString("title_setting")+"</a></dt>",b+="</dl>",b+="</li>",b+="</ul>",b+="<ul class='navigation' id='refresh'>",b+="<li>",b+="<dl>",b+="<dt><a>"+m.getString("btn_refresh")+"</a></dt>",b+="</dl>",b+="</li>",b+="</ul>",b+="<ul class='themes'>",b+="<span>"+
m.getString("title_skin")+"</span>",b+="<span id='skin1' class='themes_ctrl'></span>",b+="<span id='skin2' class='themes_ctrl'></span>",b+="</ul>");b+="<ul class='func_help'>";b+="<span id='function_help'></span>";b+="</ul>";b+="<span id='right_info'>ASUSTeK Computer Inc. All rights reserved</span>";b+="</div>";b+="<div id='modalWindow' class='jqmWindow'>";b+="<div id='jqmTitle'>";b+="<span id='jqmTitleText'></span>";b+="</div>";b+="<div id='jqmMsg'>";b+="<span id='jqmMsgText'></span>";b+="</div>";
b+="<div id='jqmContent' style='padding;0px;margin:0px'>";b+="</div>";b+="</div>";$("body").empty();$("body").append(b);$("body").click(function(){closePopupmenu()});$("span#username").click(function(){confirm(m.getString("msg_logout_confirm"))==!0&&doLOGOUT()});d=g_storage.getl("skin")==void 0?"skin1":g_storage.getl("skin");d=="skin1"?$("#mainCss").attr("href","/smb/css/style-theme1.css"):d=="skin2"&&$("#mainCss").attr("href","/smb/css/style-theme2.css");$("#btnHelp").attr("title",m.getString("title_help"));
$("#btnLogout").attr("title",m.getString("title_logout"));$("#btnConfig").attr("title",m.getString("btn_config"));$("#btnUpload").attr("title",m.getString("btn_upload"));$("#btnCancelUpload").attr("title",m.getString("btn_cancelupload"));$("#btnSelect").attr("title",m.getString("btn_select"));$("#btnCancelSelect").attr("title",m.getString("btn_cancelselect"));$("#btnNewDir").attr("title",m.getString("btn_newdir"));$("#btnShareLink").attr("title",m.getString("btn_sharelink"));$("#btnDeleteSel").attr("title",
m.getString("btn_delselect"));$("#btnDownload").attr("title",m.getString("func_download"));$("#btnRename").attr("title",m.getString("btn_rename"));$("#btnSetting").attr("title",m.getString("title_setting"));$("#btnRefresh").attr("title",m.getString("btn_refresh"))}
function addtoFavorite(){var d=g_storage.get("ddns_host_name"),b="https://"+d,a=isBrowser("msie");d==""&&(b="https://router.asus.com/");if(typeof window.sidebar=="object"&&typeof window.sidebar.addPanel=="function")return window.sidebar.addPanel("AiCloud",b,""),!1;else if(a&&typeof window.external=="object")return window.external.AddFavorite(b,"AiCloud"),!1;else{window.location=b;var d=navigator.userAgent.toLowerCase(),b="",a=d.indexOf("webkit")!=-1,e=d.indexOf("mac")!=-1;if(d.indexOf("konqueror")!=
-1)b="CTRL + B";else if(window.home||a||e)b=(e?"Command/Cmd":"CTRL")+" + D";b=b?m.getString("msg_add_favorite1")+b+m.getString("msg_add_favorite2"):b;alert(b)}}var IE=document.all?!0:!1;IE||document.captureEvents(Event.MOUSEMOVE);
function getMouseXY(d){IE?(g_mouse_x=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,g_mouse_y=event.clientY+document.body.scrollTop+document.documentElement.scrollTop):(g_mouse_x=d.pageX,g_mouse_y=d.pageY);g_mouse_x<0&&(g_mouse_x=0);g_mouse_y<0&&(g_mouse_y=0);return!0}
$(document).ready(function(){function d(a){a&&a[0]!=2?alert(m.getString(a)+" : "+decodeURI(g_selected_files[0])):(g_selected_files.splice(0,1),g_selected_files.length<=0?(a=addPathSlash(g_storage.get("openurl")),doPROPFIND(a)):client.DELETE(g_selected_files[0],d))}document.oncontextmenu=function(){return!1};document.onmousedown=function(){resetTimer()};document.onmousemove=function(a){getMouseXY(a);resetTimer()};$(document).keydown(function(a){if(a.keyCode==27){if(g_select_mode==1)cancelSelectMode();
else if(g_upload_mode==1){if(confirmCancelUploadFile()==0)return;closeUploadPanel()}closeJqmWindow()}});g_storage.set("stopLogoutTimer","0");g_storage.set("isOpenModalWindow","0");g_storage.set("isOnUploadFile","0");createLayout();showHideLoadStatus(!1);adjustLayout();(function(){var a=g_storage.get("openurl");client.GETROUTERINFO(a==void 0?"/":a,function(a,b,d){a==200&&(a=parseXml(d),a=$(a),g_storage.set("webdav_mode",a.find("webdav_mode").text()),g_storage.set("http_port",a.find("http_port").text()),
g_storage.set("https_port",a.find("https_port").text()),g_storage.set("http_enable",a.find("http_enable").text()),g_storage.set("misc_http_enable",a.find("misc_http_enable").text()),g_storage.set("misc_http_port",String(a.find("misc_http_port").text()).replace("\n","")),g_storage.set("misc_https_port",String(a.find("misc_https_port").text()).replace("\n","")),g_storage.set("last_login_info",a.find("last_login_info").text()),g_storage.set("ddns_host_name",a.find("ddns_host_name").text()),g_storage.set("router_version",
a.find("version").text()),g_storage.set("aicloud_version",a.find("aicloud_version").text()),g_storage.set("wan_ip",a.find("wan_ip").text()),g_storage.set("modalname",a.find("modalname").text()),a=g_storage.get("last_login_info"),a!=""&&a!=void 0&&(a=String(a).split(">"),a=m.getString("title_logininfo")+a[1]+", "+m.getString("title_ip")+a[2],$("#login_info").text(a)))})})();if(g_fileview_only==0){var b=g_storage.get("openurl");g_storage.set("HostList","");doPROPFIND("/",function(){b!=void 0&&b!="/"&&
doPROPFIND(b);if(g_storage.get("openhostuid")==void 0||g_storage.get("openhostuid")==0){var a="<div id='help_1'>";a+="<div id='help_content'>";a+=m.getString("msg_help");a+="</div>";a+="<div id='help_image'>";a+="</div>";a+="</div>";$("div#fileview").append(a)}},0)}else b=g_storage.get("openurl"),doPROPFIND(b);$("#modalWindow").jqm({overlay:70,modal:!0,target:"#jqmContent",onHide:function(a){var b=$(a.w);a.o.remove();b.fadeOut("200",function(){g_show_modal=0;if(g_reload_page==1){var a=addPathSlash(g_storage.get("openurl"));
doPROPFIND(a)}})},onShow:function(a){var a=$(a.w),b=$("#jqmContent",a);$("#jqmTitle",a);var c=(getPageSize()[0]-g_modal_window_width)/2;g_show_modal=1;navigator.userAgent.toLowerCase().indexOf("msie");var d=function(){var a=-1;navigator.appName=="Microsoft Internet Explorer"&&/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));return a};g_modal_url!=""&&(b.empty(),$("<iframe src='' frameborder='0' width='100%' height='100%'>").appendTo(b),$("iframe",a).attr("src",
g_modal_url));isBrowser("msie")&&d()<=8&&(g_modal_window_height+=25);a.css({width:g_modal_window_width,height:g_modal_window_height,left:c,top:-g_modal_window_height,opacity:0,display:"block"}).jqmShow().animate({width:g_modal_window_width,height:g_modal_window_height,top:0,left:c,marginLeft:0,opacity:1},200,function(){adjustLayout();$(this).css("display","block")})}});$("div#btnDeleteSel").click(function(){if(!(g_select_array.length<=0)&&confirm(m.getString("del_files_msg"))==!0){g_selected_files=
null;g_selected_files=[];for(var a=0;a<g_select_array.length;a++)g_selected_files.push(g_select_array[a].uhref);client.DELETE(g_selected_files[0],d)}});$("div#btnNewDir").click(function(){var a=$("div#modalWindow");g_modal_url="/smb/css/makedir.html";g_modal_window_width=500;g_modal_window_height=80;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_newdir"));a&&a.jqmShow()});$("div#btnShareLink").click(function(){if(!(g_select_array.length<=0)){m.getString("email_subject");
for(var a="",b="",c="",d=0;d<g_select_array.length;d++){var g=g_select_array[d].title,b=g_select_array[d].uhref,f=window.location.href,b=f=b.substring(0,b.lastIndexOf("/"));c+=g;c+=";"}var d=g_storage.get("webdav_mode"),g=g_storage.get("ddns_host_name"),j=g==""?window.location.host:g;j.indexOf(":")!=-1&&(j=j.substring(0,j.indexOf(":")));var k=isPrivateIP(j),j=d==0?"http://"+j+":"+g_storage.get("http_port"):"https://"+j;client.GSL(b,b,c,86400,1,function(b,c,d){if(b==200)if(b=parseXml(d),b=$(b).find("sharelink").text(),
b=="")alert("Fail to parse xml!");else{b=b.split(";");c=b.length;for(d=0;d<c;d++)a+=j+"/"+b[d],d!=c-1&&(a+="<br><br>");b=$("div#modalWindow");g_modal_url="/smb/css/sharelink.html?v="+a+"&b="+k;g_modal_window_width=600;g_modal_window_height=500;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_sharelink"));b&&b.jqmShow()}})}});$("div#btnDownload").click(function(){if(!(g_select_array.length<=0)){for(var a=[],b=0;b<g_select_array.length;b++){var c=g_select_array[b].title,
d=g_select_array[b].uhref,g=g_select_array[b].isdir,f=window.location.href,f=d.substring(0,d.lastIndexOf("/")),c=f+"/"+c;g==1?a.push(c):$.fileDownload(c,{successCallback:function(){},failCallback:function(a,b){window.open(b)}})}c=a.length;if(c>0){g="";for(b=0;b<c;b++)g+=a[b],b!=c-1&&(g+=";");a=$("div#modalWindow");g_modal_url="/smb/css/download_folder.html?v="+g+"&u="+g_storage.get("openurl");g_modal_window_width=600;g_modal_window_height=150;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_download_folder"));
a&&a.jqmShow()}}});$("div#btnRename").click(function(){if(g_select_array.length==1){var a=g_select_array[0].title,b=g_select_array[0].uhref,c=g_select_array[0].isdir,d=$("div#modalWindow");g_modal_url="/smb/css/rename.html?o="+a+"&f="+b+"&d="+c;g_modal_window_width=500;g_modal_window_height=80;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_rename"));d&&d.jqmShow()}});$("div#btnLock").click(function(){alert(myencodeURI("("));g_select_array.length==1&&client.LOCK(g_select_array[0].uhref,
"",function(a,b,c){a!="201"?alert("Error unlocking: "+b):(g_current_locktoken=getLockToken(c),alert("locktoken: "+g_current_locktoken))},null,"exclusive","write",0,3)});$("div#btnUnLock").click(function(){g_select_array.length==1&&client.UNLOCK(g_select_array[0].uhref,g_current_locktoken,function(a){alert(a)})});$("div#btnChangeUser").click(function(){if(confirm(m.getString("msg_changeuser_confirm"))==!0){$("#main_right_container #fileview").empty();var a=g_storage.get("openurl");client.LOGOUT(a,
function(b){b==200&&doPROPFIND(a)})}});$("div#btnSelect").click(function(){g_select_mode=1;$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("div#btnPlayImage").css("display","none");$("div#boxSearch").css("display","none");var a=$("div#btnNewDir").width()+$("div#btnUpload").width()+5;$("div#btnCancelSelect").css("display","block");$("div#btnCancelSelect").css("right",a);g_on_button_animation=1;$("div#btnCancelSelect").animate({right:5},
500,function(){$(".selectHintDiv").css("display","block");$("#fileview #fileviewicon").each(function(){$(this).addClass("select")});adjustLayout();$("#button_panel").css("left","1999px");$("#button_panel").css("display","block");$("#button_panel").animate({left:"0px"},"slow",null,function(){$("#function_help").text(m.getString("msg_selectmode_help"))});g_on_button_animation=0})});$("div#btnSelect2").click(function(){g_select_mode=1;$(".selectHintDiv").css("display","block");$("div#btnNewDir").css("display",
"none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("div#btnCancelSelect").css("display","block");$("#fileview #fileviewicon").each(function(){$(this).addClass("select")});adjustLayout();$("#button_panel").css("left","1999px");$("#button_panel").css("display","block");$("#button_panel").animate({left:"0px"},"slow",null,function(){$("#function_help").text(m.getString("msg_selectmode_help"))})});$("div#btnCancelSelect").click(function(){$("div#btnCancelSelect").css("display",
"none");$("div#btnSelect").css("display","block");$("div#btnSelect").css("right",5);g_on_button_animation=1;$("div#btnSelect").animate({right:85},500,function(){cancelSelectMode();$("div#btnSelect").css("right",5);g_on_button_animation=0})});$("#btnUpload").click(function(){closePopupmenu();var a="<div class='popupmenu' id='popupmenu'>";a+="<div class='menuitem' id='uploadfile'>";a+="<div class='menuitem-content' style='-webkit-user-select: none;'>";a+="<span class='menuitem-icon a-inline-block' style='-webkit-user-select: none;'>&nbsp;</span>";
a+="<span class='menuitem-container a-inline-block' style='-webkit-user-select: none;'>";a+="<span class='menuitem-caption a-inline-block' style='-webkit-user-select: none;'>";a+="<div style='-webkit-user-select: none;'>"+m.getString("title_upload_file")+"</div>";a+="</span>";a+="</span>";a+="</div>";a+="</div>";a+="<div class='menuitem' id='uploadfolder'>";a+="<div class='menuitem-content' style='-webkit-user-select: none;'>";a+="<span class='menuitem-icon a-inline-block' style='-webkit-user-select: none;'>&nbsp;</span>";
a+="<span class='menuitem-container a-inline-block' style='-webkit-user-select: none;'>";a+="<span class='menuitem-caption a-inline-block' style='-webkit-user-select: none;'>";a+="<div style='-webkit-user-select: none;'>"+m.getString("title_upload_folder")+"</div>";a+="</span>";a+="</span>";a+="</div>";a+="</div>";a+="</div>";$(a).appendTo("body");$(".popupmenu").css("left",g_mouse_x-$(".popupmenu").width()+"px");$(".popupmenu").css("top",g_mouse_y+"px");$("#uploadfile").click(function(){if(isBrowser("msie")&&
getInternetExplorerVersion()<=9){var a=$("div#modalWindow");g_modal_url="/smb/css/upload_file.html";g_modal_window_width=600;g_modal_window_height=150;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_upload_file"));a&&a.jqmShow()}else g_upload_mode=1,$("div#btnNewDir").css("display","none"),$("div#btnUpload").css("display","none"),$("div#btnSelect").css("display","none"),$("div#btnPlayImage").css("display","none"),$("div#boxSearch").css("display","none"),$("#upload_panel").css("display",
"block"),$("#upload_panel").css("left","1999px"),$("#upload_panel").animate({left:"0px"},"slow"),a=addPathSlash(g_storage.get("openurl")),$("#upload_panel iframe").attr("src","/smb/css/upload.html?u="+a+"&d=1"),$("#function_help").text(m.getString("msg_uploadmode_help")),adjustLayout();closePopupmenu()});$("#uploadfolder").click(function(){if(isBrowser("chrome")){g_upload_mode=1;$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");
$("div#btnPlayImage").css("display","none");$("div#boxSearch").css("display","none");$("#upload_panel").css("display","block");$("#upload_panel").css("left","1999px");$("#upload_panel").animate({left:"0px"},"slow");var a=addPathSlash(g_storage.get("openurl"));$("#upload_panel iframe").attr("src","/smb/css/upload.html?u="+a+"&d=2");$("#function_help").text(m.getString("msg_uploadmode_help"));adjustLayout();closePopupmenu()}else a=$("div#modalWindow"),g_modal_url="/smb/css/upload_folder.html",g_modal_window_width=
600,g_modal_window_height=150,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_upload_folder")),a&&a.jqmShow()});return!1});$("#btnUpload2").click(function(){g_upload_mode=1;$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("div#btnPlayImage").css("display","none");$("div#boxSearch").css("display","none");$("#upload_panel").css("display","block");$("#upload_panel").css("left","1999px");$("#upload_panel").animate({left:"0px"},
"slow");var a=addPathSlash(g_storage.get("openurl"));$("#upload_panel iframe").attr("src","/smb/css/upload.html?u="+a);$("#function_help").text(m.getString("msg_uploadmode_help"));adjustLayout()});$("#btnCancelUpload").click(closeUploadPanel);$("div#hostview").scroll(function(){g_storage.set("hostviewscrollTop",$(this).scrollTop())});$("div#fileview").scroll(function(){g_storage.set("contentscrollLeft",$(this).scrollLeft());g_storage.set("contentscrollTop",$(this).scrollTop())});$(".navigation#lan dd a").click(function(){if(confirmCancelUploadFile()!=
0){var a=$(this).attr("id");g_storage.set("lan",a);window.location.reload()}});$(".navigation#setting dd a").click(function(){var a=$(this).attr("id");if(a=="logout")confirmCancelUploadFile()!=0&&(a=confirm(m.getString("msg_logout_confirm")),a==!0&&doLOGOUT());else if(a=="favorite")addtoFavorite();else if(a=="config"){var b=g_storage.get("http_enable"),c=g_storage.get("misc_http_enable"),d=g_storage.get("misc_http_port"),g=g_storage.get("misc_https_port"),f=window.location.host,j="http",a=d;c==0&&
!isPrivateIP()?alert(m.getString("msg_no_config")):(b=="0"?(j="http",a=d):b=="1"&&(j="https",a=g),isPrivateIP()?b=j+"://"+f.split(":")[0]:(b=j+"://"+f.split(":")[0],a!=""&&(b+=":"+a)),window.location=b)}else a=="help"?(a=$("div#modalWindow"),b=getPageSize(),g_modal_window_height=b[1]-30,g_modal_window_width=g_modal_window_height*1.28,g_modal_window_width>b[0]&&(g_modal_window_width=b[0],g_modal_window_height=g_modal_window_width*0.78125),g_modal_url="/smb/css/help.html?showbutton=1",$("#jqmMsg").css("display",
"none"),$("#jqmTitleText").text(m.getString("title_help")),a&&a.jqmShow()):a=="rescan_samba"?confirmCancelUploadFile()!=0&&(a=confirm(m.getString("title_desc_rescan")),a==!0&&doRescanSamba()):a=="sharelink"?(a=$("div#modalWindow"),b=getPageSize(),g_modal_url="/smb/css/setting.html?p=1&s=1",g_modal_window_width=800,g_modal_window_height=b[1]-30,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_setting")),a&&a.jqmShow()):a=="version"?(a=$("div#modalWindow"),b=getPageSize(),
g_modal_url="/smb/css/setting.html?p=2&s=1",g_modal_window_width=800,g_modal_window_height=b[1]-30,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_setting")),a&&a.jqmShow()):a=="other_settings"?(a=$("div#modalWindow"),b=getPageSize(),g_modal_url="/smb/css/setting.html?p=3&s=1",g_modal_window_width=800,g_modal_window_height=b[1]-30,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_setting")),a&&a.jqmShow()):a=="test"&&client.GETROUTERINFO("/AICLOUD306106790/AiCloud",
function(a,b,c){a==200&&(a=parseXml(c),a=$(a),g_storage.set("webdav_mode",a.find("webdav_mode").text()),g_storage.set("http_port",a.find("http_port").text()),g_storage.set("https_port",a.find("https_port").text()),g_storage.set("misc_http_enable",a.find("misc_http_enable").text()),g_storage.set("misc_http_port",String(a.find("misc_http_port").text()).replace("\n","")),g_storage.set("last_login_info",a.find("last_login_info").text()),g_storage.set("ddns_host_name",a.find("ddns_host_name").text()),
g_storage.set("router_version",a.find("version").text()),g_storage.set("wan_ip",a.find("wan_ip").text()),a=g_storage.get("last_login_info"),a!=""&&a!=void 0&&(a=String(a).split(">"),a=m.getString("title_logininfo")+a[1]+", "+m.getString("title_ip")+a[2],$("#login_info").text(a)))})});$(".navigation#refresh dt a").click(function(){if(confirmCancelUploadFile()!=0){var a=g_storage.get("openurl");g_storage.set("HostList","");doPROPFIND("/",function(){a=a==void 0?"/":a;a!="/"&&doPROPFIND(a)},0)}});$(".themes_ctrl").click(function(){if(confirmCancelUploadFile()!=
0){var a=$(this).attr("id");g_storage.setl("skin",a);window.location.reload()}});$("div#btnPlayImage").click(function(){openImageViewer()});$("div#boxSearch").keyup(function(){var a=myencodeURI($("div#boxSearch input").val()),b=$(this).attr("uhref"),c=$(this).attr("qtype");doPROPFINDMEDIALIST(b,!1,function(){},c,"0","50",a,"TIMESTAMP","DESC")});$("div#logo").click(function(){g_fileview_only!=1&&doPROPFIND("/",function(){g_storage.set("openhostuid","");window.location.reload()},0)});$(window).resize(adjustLayout)});
window.onbeforeunload=function(d){if(g_storage.get("isOnUploadFile")==1){var b=m.getString("msg_confirm_cancel_upload");if(d=d||window.event)d.returnValue=b;return b}};window.onunload=function(){g_storage.get("isOnUploadFile")==1&&$("#upload_panel iframe")[0].contentWindow.stop_upload()};
