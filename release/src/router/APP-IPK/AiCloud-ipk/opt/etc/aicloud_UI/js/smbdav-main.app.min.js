var g_support_html5=0,g_reload_page=1,m=new lang,g_storage=new myStorage,g_listview=g_storage.get("listview")==void 0?0:g_storage.get("listview"),g_modal_url,g_modal_window_width=200,g_modal_window_height=80,timer_idle,g_show_modal=0,g_time_out=9E5,g_time_count=0,g_select_mode=0,g_select_array,g_upload_mode=0,g_folder_array,g_file_array,g_opening_uid="",g_on_button_animation=0,g_on_rescan_samba=0,g_rescan_samba_timer=0,g_rescan_samba_count=0,g_aidisk_name="usbdisk",g_enable_aidisk=0,g_support_lan=
["zh-tw","en-us"],g_bInitialize=!1,g_showAudioList=!1,g_jplayer_solution="html",g_jplayer_supplied="mp3",g_audio_playlist=[],g_current_index=0,g_timer_filelist,newMenu=null,client=new davlib.DavClient;client.initialize();g_support_html5=window.File&&window.FileReader&&window.FileList&&window.Blob?1:0;
function openImageViewer(a){for(var c=[],b=0;b<g_file_array.length;b++){var d=getFileExt(g_file_array[b].href);(d=="jpg"||d=="jpeg"||d=="png"||d=="gif")&&c.push(g_file_array[b])}if(c.length==0)alert(m.getString("msg_no_image_list"));else{for(b=d=0;b<c.length;b++)a==c[b].href&&(d=b);a="";b=getPageSize();a+='<div id="image_slide_show" class="barousel unselectable" style="height: 0; width: 0; position: fixed; background-color: rgb(0, 0, 0); left: '+b[0]/2+"px; top: "+b[1]/2+'px; z-index: 2999;">';a+=
'<div class="barousel_image">';for(b=0;b<c.length;b++){var e=window.location.protocol+"//"+window.location.host+c[b].href;a+=b==d?'<img src="" path="'+e+'" alt="" class="default"/>':'<img src="" path="'+e+'" alt="" class=""/>'}a+="</div>";a+='<div class="barousel_nav">';a+='<div class="barousel_content transparent" style="display: block; ">';for(b=0;b<c.length;b++)a+='<div class="',b==d&&(a+="default"),a+='" style="display: none; ">',a+='<p class="header">'+c[b].name+"</p>",a+="</div>";a+="</div>";
a+="</div>";a+="</div>";$(a).animate({width:"100%",height:"100%",left:"0px",top:"0px"},200,null,null).appendTo("body");$("#image_slide_show").barousel({navType:2,manualCarousel:1,contentResize:0,startIndex:d})}}function openDialog(a,c){$.mobile.changePage("#dialog",{transition:a,role:c})}function closeDialog(){$.mobile.changePage("#mainpage","popup",!0,!0)}
function openLoginWindow(a){var c="",b=function(){var c=$("#table_content input#username").val(),b=$("#table_content input#password").val(),c="Basic "+Base64.encode(c+":"+b);closeDialog();doLOGIN(a,c)},c=a=="/"?m.getString("title_login")+" - AiCloud":m.getString("title_login")+" - "+a.substring(0,35);$("#dialog").remove();var d="";d+="<div data-role='dialog' id='dialog' data-theme='a' data-transition='flip'>";d+="<div data-role='header'>";d+="<h1 id='dialog-title'>"+c+"</h1>";d+="</div>";d+="<div data-role='content' id='dialog-content'>";
d+='<table id="table_content" width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="overflow:hidden;">';d+="<tr>";d+="<td>";d+='<form name="form_login">';d+="<fieldset>";d+='<table width="100%">';d+="<tr>";d+='<td width="80px"><label id="username">'+m.getString("title_username")+'</label></td><td><input name="username" type="text" id="username" size="35" autocapitalize="off"></td>';d+="</tr>";d+="<tr>";d+='<td width="80px"><label id="password">'+m.getString("title_password")+
'</label></td><td><input name="password" type="password" id="password" size="35"></td>';d+="</tr>";d+="</table>";d+="</fieldset>";d+="</form>";d+="</td>";d+="</tr>";d+='<tr style="height:10px"></tr>';d+="<tr>";d+="<td>";d+='<div class="table_block_footer" style="text-align:right">';d+='<button id="ok" class="btnStyle">'+m.getString("btn_ok")+"</button>";d+='<button id="cancel" class="btnStyle">'+m.getString("btn_cancel")+"</button>";d+="</div>";d+="</td>";d+="</tr>";d+="</table>";d+="</div>";d+="</div>";
$("body").append(d);$("#table_content input#password").keydown(function(a){a.keyCode==13&&b()});$("#table_content #ok").click(function(){b()});$("#table_content #cancel").click(function(){closeDialog()});openDialog("pop","dialog")}
function openShareWindow(a){$("#dialog").remove();var c=a.split(";"),a="";a+="<div data-role='dialog' id='dialog' data-theme='a' data-transition='flip'>";a+="<div data-role='header'>";a+="<h1 id='dialog-title'>"+m.getString("btn_sharelink")+"</h1>";a+="</div>";a+="<div data-role='content' id='dialog-content'>";a+='<table id="table_content" width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="overflow:hidden;">';a+="<tr>";a+="<td>";a+='<textarea id="share_link">';
for(var b=0;b<c.length;b++)a+=decodeURI(c[b]),a+="\n\n";a+="</textarea>";a+="</td>";a+="</tr>";a+="<tr>";a+="<td>";a+='<div class="table_block_footer" style="text-align:right">';a+='<button id="email-sharelink" class="btnStyle">'+m.getString("title_share_by_email")+"</button>";a+='<button id="cancel" class="btnStyle">'+m.getString("btn_cancel")+"</button>";a+="</div>";a+="</td>";a+="</tr>";a+="</table>";a+="</div>";a+="</div>";$("body").append(a);$("#table_content #email-sharelink").click(function(){var a=
"mailto:",b="";b+=m.getString("msg_sharelink_desc1");b+="%0D%0A%0D%0A";for(var g=0;g<c.length;g++)b+="<a href='"+c[g]+"'>"+c[g]+"</a>",b+="%0D%0A%0D%0A";b+=m.getString("msg_sharelink_desc2");a+="?subject="+m.getString("email_subject")+"&body="+b;document.location.href=a});$("#table_content #sms-sharelink").click(function(){var a="sms:",b="";b+=m.getString("msg_sharelink_desc1");b+="%0D%0A%0D%0A";for(var g=0;g<c.length;g++)b+="<a href='"+c[g]+"'>"+c[g]+"</a>",b+="%0D%0A%0D%0A";b+=m.getString("msg_sharelink_desc2");
a+="?subject="+m.getString("email_subject")+"&body="+b;document.location.href=a});$("textarea#share_link").click(function(){$(this).select()});$("#table_content #cancel").click(function(){closeDialog()});openDialog("pop","dialog")}
function getLatestVersion(){client!=null&&($("#update").text(m.getString("msg_check_latest_ver")),client.GETLATESTVER("/",function(a,c,b){a==200?(a=parseXml(b),a=$(a).find("version").text().split("_")[1],c=g_storage.get("router_version").split(".")[3],a>c?$("#update").text(m.getString("msg_update_latest_ver")):$("#update").text(m.getString("msg_latest_ver"))):$("#update").text(m.getString("msg_check_latest_ver_error"))}))}
function refreshShareLinkList(){client!=null&&client.GSLL("/",function(a,c,b){if(a==200){a=parseXml(b);$(".sharelink").empty();var d="";$(a).find("sharelink").each(function(){var a=decodeURI($(this).attr("filename"));$(this).attr("url");var b=$(this).attr("createtime"),c=$(this).attr("expiretime"),k=parseFloat($(this).attr("lefttime")),l=parseInt(k/3600),k=parseInt(k%3600/60);d="<li><a href='#' data-icon='delete'>";d+="<h3>"+a+"</h3>";d+="<p class='ui-li-desc'>";d+=m.getString("table_createtime")+
": ";d+=b;d+="</p>";d+="<p class='ui-li-desc'>";d+=m.getString("table_expiretime")+": ";d+=c==0?m.getString("title_unlimited"):c;d+="</p>";d+="<p class='ui-li-desc'>";d+=m.getString("table_lefttime")+": ";d+=c==0?m.getString("title_unlimited"):l+" hours "+k+" mins";d+="</p>";d+="</a><a href='#' class='dellink' link='"+$(this).attr("url")+"'></a></li>";$("ul.sharelink").append(d).find("li:last").hide();$("ul.sharelink").listview("refresh");$("ul.sharelink").find("li:last").slideDown(300)});$(".dellink").click(function(){confirm(m.getString("msg_confirm_delete_sharelink"))==
!0&&client.REMOVESL("/",$(this).attr("link"),function(a){a==200?refreshShareLinkList():alert("Fail to delete sharelink!")})})}})}
function openSettingWindow(){var a=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),a=g_storage.get("lan")==void 0?a:g_storage.get("lan");$("#dialog").remove();var c="";c+="<div data-role='page' id='dialog' data-theme='a'>";c+="<div data-role='header'>";c+="<h1 id='dialog-title'>"+m.getString("title_setting")+"</h1>";c+="<a id='back' data-role='button'>"+m.getString("btn_prevpage")+"</a>";c+="</div>";c+="<div data-role='content' id='dialog-content' class='setting-set'>";
c+="<div data-role='collapsible-set'>";c+="<div data-role='collapsible' data-collapsed='true'>";c+="<h2>"+m.getString("title_rescan")+"</h2>";c+="<a id='rescan' data-role='button'>"+m.getString("btn_rescan")+"</a>";c+="</div>";c+="<div data-role='collapsible' data-collapsed='true'>";c+="<h2>"+m.getString("title_sharelink")+"</h2>";c+="<ul data-role='listview' data-inset='true' class='sharelink' data-theme='a' data-split-theme='a' data-split-icon='delete'></ul>";c+="</div>";c+="<div data-role='collapsible'>";
c+="<h2>"+m.getString("title_version")+"</h2>";c+="<span id='version'>AiCloud "+m.getString("title_version")+": "+g_storage.get("aicloud_version")+"</span>";c+="<br><span id='version'>FW "+m.getString("title_version")+": "+g_storage.get("router_version")+"</span>";c+="<br><span id='update' style='color:red'></span>";c+="</div>";c+="<div data-role='collapsible'>";c+="<h2>"+m.getString("title_language")+"</h2>";c+="<div data-role='controlgroup'>";for(var b=0;b<g_support_lan.length;b++)c+="<label for='"+
g_support_lan[b]+"'>"+m.getString("lan_"+g_support_lan[b])+"</label>",c+="<input type='radio' id='"+g_support_lan[b]+"' name='group_lan' value='"+g_support_lan[b]+"'",g_support_lan[b]==a&&(c+=" checked"),c+=">";c+="</div>";c+="</div>";c+="</div>";c+="</div>";c+="</div>";$("body").append(c);getLatestVersion();refreshShareLinkList();$("#rescan").click(function(){doRescanSamba()});$("#back").click(function(){closeDialog()});$("input[type=radio]").click(function(){var a=$(this).attr("id");g_storage.set("lan",
a);window.location.reload()});openDialog("flip","page")}function showHideAudioList(a){a?$(".jp-playlist").css("display","block"):$(".jp-playlist").css("display","none");g_showAudioList=a}function showHideAudioInterface(a){a?$("#jp_interface_1").css("display","block"):$("#jp_interface_1").css("display","none")}
function openAudioPlayer(a){for(var c=[],b=0;b<g_file_array.length;b++)getFileExt(g_file_array[b].href)=="mp3"&&c.push(g_file_array[b]);b=c.length;if(b==0)alert(m.getString("msg_no_image_list"));else{showHideLoadStatus(!0);for(var d=[],e=a,b=g_current_index=0;b<c.length;b++)e=c[b].href,a==e&&(g_current_index=b),d.push(e);b=d.length;if(b==0)alert(m.getString("msg_no_image_list"));else{g_audio_playlist=[];$("#audio_dialog").remove();b="";b+='<div data-role="dialog" id="audio_dialog">';b+='<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">';
b+='<tr style="height:180px">';b+="<td>";b+='<div id="container" style="width:300px;margin:auto">';b+='<div id="jquery_jplayer_1" class="jp-jplayer"></div>';b+='<div id="jp_container_1" class="jp-audio">';b+='<div class="jp-type-playlist">';b+='<div id="jp_title_1" class="jp-title">';b+="<ul>";b+="<li></li>";b+="</ul>";b+="</div>";b+='<div id="jp_interface_1" class="jp-gui jp-interface">';b+='<ul class="jp-controls">';b+='<li><a href="javascript:;" class="jp-previous" tabindex="1">previous</a></li>';
b+='<li><a href="javascript:;" class="jp-play" tabindex="1" style="display: block; ">play</a></li>';b+='<li><a href="javascript:;" class="jp-pause" tabindex="1" style="display: block; ">pause</a></li>';b+='<li><a href="javascript:;" class="jp-next" tabindex="1">next</a></li>';b+='<li><a href="javascript:;" class="jp-stop" tabindex="1">stop</a></li>';b+='<li><a href="javascript:;" class="jp-mute" tabindex="1" title="mute">mute</a></li>';b+='<li><a href="javascript:;" class="jp-volume-max" tabindex="1" title="max volume">max volume</a></li>';
b+="</ul>";b+='<div class="jp-progress">';b+='<div class="jp-seek-bar" style="width: 100%; ">';b+='<div class="jp-play-bar" style="width: 46.700506341691536%;"></div>';b+="</div>";b+="</div>";b+='<div class="jp-volume-bar">';b+='<div class="jp-volume-bar-value" style="width: 31.979694962501526%; "></div>';b+="</div>";b+='<div class="jp-duration">00:00</div>';b+='<div class="jp-split">/</div>';b+='<div class="jp-current-time">00:00</div>';b+="</div>";b+='<div id="jp_playlist_1" class="jp-playlist">';
b+="<ul></ul>";b+="</div>";b+='<div class="jp-no-solution" style="display: none; ">';b+="<span>Update Required</span>";b+='To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.';b+="</div>";b+="</div>";b+="</div>";b+="</div>";b+="</td>";b+="</tr>";b+='<tr style="height:10px"></tr>';b+="<tr>";b+="<td>";b+='<div class="table_block_footer" style="text-align:right">';b+='<button id="playlist" class="btnStyle">PlayList</button>';
b+='<button id="cancel" class="btnStyle">Close</button>';b+="</div>";b+="</td>";b+="</tr>";b+="</table>";b+="</div>";$("body").append(b);$("#jp_title_1 li").text("Loading...");$("#playlist").css("visibility","hidden");$("#audio_dialog #playlist").click(function(){showHideAudioList(!g_showAudioList)});$("#audio_dialog #cancel").click(function(){$("#jquery_jplayer_1").jPlayer("stop");$("#jquery_jplayer_1").jPlayer("clearMedia");$.mobile.changePage("#mainpage","popup",!0,!0)});var g=0,f=!1;generate_sharelink=
1;if(generate_sharelink==1){var k=window.location.host;k.indexOf(":")!=-1&&(k=k.substring(0,k.indexOf(":")));var k="http://"+k+":"+g_storage.get("http_port")+"/",l=setInterval(function(){if(f==!1)if(g<0||g>d.length-1)clearInterval(l),initJPlayer(),showHideLoadStatus(!1),$.mobile.changePage("#audio_dialog",{transition:"pop",role:"dialog"});else{var a=d[g],b=a.substring(a.lastIndexOf("/")+1,a.length),a=a.substring(0,a.lastIndexOf("/"));f=!0;client.GSL(a,a,b,0,0,function(a,c,d){if(a==200)a=parseXml(d),
a=$(a).find("sharelink").text(),a=k+a,f=!1,c=[],c.name=mydecodeURI(b),c.mp3=a,g_audio_playlist.push(c),g++})}},100)}else{for(b=0;b<d.length;b++)e=d[b],a=e.substring(e.lastIndexOf("/")+1,e.length),e.substring(0,e.lastIndexOf("/")),c=[],c.name=mydecodeURI(a),c.mp3=e,g_audio_playlist.push(c);initJPlayer();showHideLoadStatus(!1);$.mobile.changePage("#audio_dialog",{transition:"pop",role:"dialog"})}}}}
function doRescanSamba(){var a=addPathSlash(g_storage.get("openurl"));closeDialog();showHideLoadStatus(!0);client.RESCANSMBPC(a,function(a){a[0]==2&&(g_storage.setl("onRescanSamba",1),g_storage.setl("onRescanSambaCount",0),g_storage.set("HostList",""),doPROPFIND("/"))})}
function doMKDIR(a){var c=addPathSlash(g_storage.get("openurl")),b=c+myencodeURI(a),d=0;$("li#list_item").each(function(){$(this).attr("isdir")=="1"&&a==$(this).attr("title")&&(d=1,alert(m.getString("folder_already_exist_msg")))});d!=1&&client.MKCOL(b,function(a){a[0]==2?doPROPFIND(c):alert(m.getString(a))})}
function doRENAME(a,c){var b=0,d=addPathSlash(g_storage.get("openurl")),e=d+c;$("li#list_item").each(function(){c==myencodeURI($(this).attr("title"))&&(b=1,$(this).attr("isdir")=="1"?alert(m.getString("folder_already_exist_msg")):alert(m.getString("file_already_exist_msg")))});b!=1&&client.MOVE(a,e,function(b){b[0]==2?doPROPFIND(d):alert(m.getString(b)+" : "+decodeURI(a))},null,!1)}function getFileViewHeight(){return $("#fileview").height()}
function closeUploadPanel(a){g_upload_mode=0;g_reload_page=a;g_storage.set("stopLogoutTimer","0");$("div#btnNewDir").css("display","block");g_support_html5==1&&$("div#btnUpload").css("display","block");$("div#btnSelect").css("display","block");$("#btnPlayImage").css("display","block");$("div#btnCancelUpload").css("display","none");$("#function_help").text("");$("#upload_panel").animate({left:"1999px"},"slow",null,function(){$("#upload_panel").css("display","none");adjustLayout()});a==1&&(a=addPathSlash(g_storage.get("openurl")),
doPROPFIND(a))}function openSelectMode(){g_select_mode!=1&&($("li#list_item").removeClass("ui-btn-active"),$("li#list_item").removeClass("selected"),$("li#list_item #icon").addClass("selectmode"),$("#navbar").css("display","none"),$("#navbar2").css("display","block"),$("#btn-delete").addClass("ui-disabled"),$("#btn-rename").addClass("ui-disabled"),$("#btn-share").addClass("ui-disabled"),g_select_mode=1)}
function cancelSelectMode(){g_select_mode!=0&&($("#navbar").css("display","block"),$("#navbar2").css("display","none"),$("li#list_item #icon").removeClass("selectmode"),$("li#list_item #icon").removeClass("checked"),$("li#list_item").removeClass("ui-btn-active"),$("li#list_item").removeClass("selected"),g_select_mode=0)}
function adjustLayout(){var a=getPageSize()[1];$(".ui-mobile-viewport").width();a=$(".ui-mobile-viewport").height();$("div#content").css("height",a-$("#header").height()-$("#footer").height()-$("#btnParent").height()-parseInt($("#content").css("padding"))*2)}function closeJqmWindow(a){g_reload_page=a;a=$("div#modalWindow");$("iframe",a).attr("src","");a&&a.jqmHide();showHideLoadStatus(!1)}function resizeJqmWindow(a,c){var b=$(".jqmWindow");b&&(b.css("width",a+"px"),b.css("height",c+"px"))}
function fullscreenJqmWindow(){var a=$("div#modalWindow");a&&(a.css("left","0px"),a.css("top","0px"),a.css("width",window.width+"px"),a.css("height",window.height+"px"))}function doLOGOUT(){doPROPFIND("/",function(){addPathSlash(g_storage.get("openurl"));client.LOGOUT("/",function(a){a[0]==2&&(g_storage.set("openhostuid","0"),window.location.reload())})},0)}
function resetTimer(){clearInterval(timer_idle);g_time_count=0;timer_idle=setInterval(function(){g_storage.get("stopLogoutTimer")=="1"||g_show_modal==1?g_time_count=0:(g_time_count++,g_time_count*1E3>g_time_out&&(g_time_count=0,doLOGOUT()))},1E3)}
function createOpenUrlUI(a){a==void 0&&(a="/");var c=mydecodeURI(a),b="",d="",e="",g=$("#urlregion-url").width();if(c!="/")for(var c=c.split("/"),a=a.split("/"),f=0;f<c.length;f++)if(!(c[f]==""||g_enable_aidisk==1&&c[f]==g_aidisk_name)){d+="/"+a[f];e+=" / <a id='url_path' uhref='"+d+"'>"+c[f]+"</a>";if(String(e).width($("p#openurl").css("font"))>g){b+=" / ...";break}b+=c[1]==g_aidisk_name&&g_enable_aidisk==1?" / <a id='url_path' uhref='/"+g_aidisk_name+d+"'>"+c[f]+"</a>":" / <a id='url_path' uhref='"+
d+"'>"+c[f]+"</a>";e=b}$("p#openurl").empty();$("p#openurl").append(b);$("a#url_path").click(function(){doPROPFIND($(this).attr("uhref"))})}
function doPROPFIND(a,c,b){if(client!=null){showHideLoadStatus(!0);try{client.PROPFIND(a,b,function(b,d,f){if(b){if(b==207){cancelSelectMode();closeUploadPanel();g_folder_array=[];g_file_array=[];if(window.DOMParser)b=new DOMParser,d=b.parseFromString(f,"text/xml");else if(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(f),!d.documentElement){alert("Fail to load xml!");showHideLoadStatus(!1);return}var k,l,o,h,p,G=d.documentElement.childNodes,f=d.documentElement.getAttribute("qtype");
d.documentElement.getAttribute("readonly");b=d.documentElement.getAttribute("ruser");d.documentElement.getAttribute("computername");d=d.documentElement.getAttribute("isusb");for(k=0;k<G.length;k++){var n="",t="",u="",q="",v="",w="",x="",y="",z="",A="",B="",C="",D="",j,E="0",r=G[k].childNodes;for(l=0;l<r.length;l++)if(r[l].nodeType==1&&r[l].nodeName=="D:propstat"){var F=r[l].childNodes;for(o=0;o<F.length;o++)if(F[o].nodeName=="D:prop"){var i=F[o].childNodes;for(h=0;h<i.length;h++)if(!(i[h].childNodes.length<=
0))if(i[h].nodeName=="D:getcontenttype")t=String(i[h].childNodes[0].nodeValue);else if(i[h].nodeName=="D:getuniqueid")u=String(i[h].childNodes[0].nodeValue);else if(i[h].nodeName=="D:getonline")w=String(i[h].childNodes[0].nodeValue);else if(i[h].nodeName=="D:getlastmodified")x=String(i[h].childNodes[0].nodeValue);else if(i[h].nodeName=="D:getcontentlength")y=String(size_format(parseInt(i[h].childNodes[0].nodeValue)));else if(i[h].nodeName=="D:getmac")A=String(i[h].childNodes[0].nodeValue);else if(i[h].nodeName==
"D:getip")z=String(i[h].childNodes[0].nodeValue);else if(i[h].nodeName=="D:gettype")B=String(i[h].childNodes[0].nodeValue);else if(i[h].nodeName=="D:getattr"){var s=i[h].childNodes;for(p=0;p<s.length;p++)if(s[p].nodeName=="D:readonly")C=s[p].childNodes[0].nodeValue;else if(s[p].nodeName=="D:hidden")D=s[p].childNodes[0].nodeValue}else i[h].nodeName=="D:getroutersync"&&(E=String(i[h].childNodes[0].nodeValue))}}else r[l].nodeType==1&&r[l].nodeName=="D:href"&&(n=String(r[l].childNodes[0].nodeValue),o=
"",n.match(/^http/)&&(o=window.location.protocol+"//"+window.location.host),h=o+addPathSlash(a),n!=h?(n=n.replace(o,""),q=n.substring(n.lastIndexOf("/")+1,n.length),q!=""?(j=q,v=q=mydecodeURI(q)):n=""):n="");n!=""&&(t=="httpd/unix-directory"?g_folder_array.push({contenttype:t,href:n,name:q,uname:j,shortname:v,online:w,time:x,size:y,ip:z,mac:A,uid:u,type:B,freadonly:C,fhidden:D,routersyncfolder:E}):g_file_array.push({contenttype:t,href:n,name:q,uname:j,shortname:v,online:w,time:x,size:y,ip:z,mac:A,
uid:u,type:B,freadonly:C,fhidden:D,routersyncfolder:E}))}g_folder_array.sort(sortByName);g_file_array.sort(sortByName);for(j=0;j<g_folder_array.length;j++)g_folder_array[j].type=="usbdisk"&&arraymove(g_folder_array,j,0);j=addPathSlash(a);j!="/"&&(j=j.substring(0,j.length-1),j=j.substring(0,j.lastIndexOf("/")),j==""&&(j="/"));createListView(f,j,g_folder_array,g_file_array);f==1&&d==0?$("#btn-changeuser").show():$("#btn-changeuser").hide();f==0?$("#btn-select").show():$("#btn-select").hide();$("span#username").text(b);
adjustLayout();closeDialog();g_storage.set("openurl",a);$(".ui-listview").attr("path",a);c!=void 0&&c()}else b==501?doPROPFIND(a):b==401?setTimeout(openLoginWindow(a),1E3):alert(m.getString(b));showHideLoadStatus(!1)}},null,1),resetTimer()}catch(d){alert("catch error: "+d)}}}function doLOGIN(a,c){doPROPFIND(a,function(){},c)}
function createListView(a,c,b,d){clearInterval(g_timer_filelist);$("ul#list").empty();$("#btnParent").remove();if(a==0||a==1){var e="";e+='<div id="btnParent" class="ui-btn-text ui-btn-parent" data-icon="home" data-role="button" data-iconpos="left" ';e+=' online="0" qtype="1" isdir="1" uhref="'+c+'"><span>';e+=m.getString("btn_prevpage");e+="</span></div>";$("#content").before(e)}for(c=0;c<b.length;c++)e="",e+='<li id="list_item" qtype="',e+=a,e+='" isdir="1" uhref="',e+=b[c].href,e+='" title="',
e+=b[c].name,e+='" online="',e+=b[c].online,e+='" ip="" mac="',e+=b[c].mac,e+='" uid="',e+=b[c].uid,e+='" freadonly="',e+=b[c].freadonly,e+='" fhidden="',e+=b[c].fhidden,e+=b[c].type=="usbdisk"?'" isusb="1"':'" isusb="0"',e+='" data-icon="cloud-arrow-r">',e+="<a href='#' data-transition='slide' class='ui-btn-icon-left'>",a==2?b[c].type=="usbdisk"?e+="<span id='icon' class='sicon usbdisk ui-folder-icon ui-li-thumb ":b[c].type=="sambapc"&&(e+=b[c].online==1?"<span id='icon' class='sicon sambapc ui-folder-icon ui-li-thumb ":
"<span id='icon' class='sicon sambapcoff ui-folder-icon ui-li-thumb "):e+="<span id='icon' class='sicon folder ui-folder-icon ui-li-thumb ",g_select_mode==1&&(e+="selectmode"),e+="'>",b[c].routersyncfolder=="1"&&(e+="<div id='icon' class='sicon routerync'/>"),e+="</span>",e+="<h3>"+b[c].shortname,b[c].online=="0"&&a=="2"&&(e+="("+m.getString("title_offline")+")"),e+="</h3>",a=="0"&&(e+="<p class='ui-li-desc'>",e+=m.getString("table_time")+": "+b[c].time,e+="</p>"),e+="</a>",e+="</li>",$("ul#list").append(e).find("li:last").hide(),
$("ul#list").listview("refresh"),$("ul#list").find("li:last").slideDown(300);var g=0;g_timer_filelist=setInterval(function(){if(g<0||g>d.length-1)clearInterval(g_timer_filelist);else{var a=g;m.getString("table_time");m.getString("table_size");var b=getFileExt(String(d[a].href));b.length>5&&(b="");var c="";c+='<li data-theme="c" id="list_item" qtype="1" isdir="0" uhref="';c+=d[a].href;c+='" title="';c+=d[a].name;c+='" uid="';c+=d[a].uid;c+='" ext="';c+=b;c+='" freadonly="';c+=d[a].freadonly;c+='" fhidden="';
c+=d[a].fhidden;c+='">';c+=b=="jpg"||b=="jpeg"||b=="png"||b=="gif"||b=="bmp"?"<span id='icon' class='sicon ui-li-thumb ui-file-icon imgfileDiv ":b=="mp3"||b=="m4a"||b=="m4r"||b=="wav"?"<span id='icon' class='sicon ui-li-thumb ui-file-icon audiofileDiv ":b=="mp4"||b=="rmvb"||b=="m4v"||b=="wmv"||b=="avi"||b=="mpg"||b=="mpeg"||b=="mkv"||b=="mov"||b=="flv"||b=="3gp"||b=="m2v"||b=="rm"?"<span id='icon' class='sicon ui-li-thumb ui-file-icon videofileDiv ":b=="doc"||b=="docx"?"<span id='icon' class='sicon ui-li-thumb ui-file-icon docfileDiv ":
b=="ppt"||b=="pptx"?"<span id='icon' class='sicon ui-li-thumb ui-file-icon pptfileDiv ":b=="xls"||b=="xlsx"?"<span id='icon' class='sicon ui-li-thumb ui-file-icon xlsfileDiv ":b=="pdf"?"<span id='icon' class='sicon ui-li-thumb ui-file-icon pdffileDiv ":"<span id='icon' class='sicon ui-li-thumb ui-file-icon fileDiv ";g_select_mode==1&&(c+="selectmode");c+="'/>";c+="<div id='file_item' class='ui-btn-text'>";c+="<h3>"+d[a].shortname+"</h3>";c+="<p class='ui-li-desc'>";c+=m.getString("table_time")+": "+
d[a].time;c+="</p>";c+="<p class='ui-li-desc'>";c+=m.getString("table_size")+": "+d[a].size;c+="</p>";c+="</div>";c+="</li>";$("ul#list").append(c).find("li:last").hide();$("ul#list").listview("refresh");$("ul#list").find("li:last").slideDown(300);g++}},200)}function sortByName(a,c){var b=a.name.toLowerCase(),d=c.name.toLowerCase();return b<d?-1:b>d?1:0}function arraymove(a,c,b){var d=a[c];a.splice(c,1);a.splice(b,0,d)}
function showHideLoadStatus(a){a?$.mobile.showPageLoadingMsg():$.mobile.hidePageLoadingMsg()}
function openSelItem(a){var c=a.attr("uhref"),b=a.attr("qtype"),d=a.attr("isdir"),e=a.attr("isusb"),g=a.attr("uhref"),f=a.attr("title");g_storage.set("openuid",a.attr("uid"));g_storage.set("opentype",e);if(b==2&&a.attr("online")==0)confirm(m.getString("wol_msg"))==!0&&(c=a.attr("mac"),client.WOL("/",c,function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))}));else if(d=="1")doPROPFIND(c,null,null);else if(a=getFileExt(c),g_storage.get("webdav_mode"),a=="mp3")openAudioPlayer(c);
else{if(a=="doc"||a=="docx"||a=="ppt"||a=="pptx"||a=="xls"||a=="xlsx"||a=="pdf")if((isWinOS()||isMacOS())&&!isPrivateIP()){f=myencodeURI(f);this_url=g.substring(0,g.lastIndexOf("/"));client.GSL(this_url,this_url,f,0,0,function(a,b,c){a==200&&(a=parseXml(c),a=$(a).find("sharelink").text(),b="",a=window.location.protocol+"//"+window.location.host+"/"+a,window.open("https://docs.google.com/viewer?url="+a))});return}a=="jpg"||a=="jpeg"||a=="png"||a=="gif"?openImageViewer(c):window.open(c)}}
function createLayout(){var a=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),a=g_storage.get("lan")==void 0?a:g_storage.get("lan");m.setLanguage(a);$("#btn-home .ui-btn-text").text(m.getString("btn_homepage"));$("#btn-refresh .ui-btn-text").text(m.getString("btn_refresh"));$("#btn-logout .ui-btn-text").text(m.getString("title_logout"));$("#btn-setting .ui-btn-text").text(m.getString("title_setting"));$("#btn-delete .ui-btn-text").text(m.getString("btn_delselect"));
$("#btn-rename .ui-btn-text").text(m.getString("btn_rename"));$("#btn-share .ui-btn-text").text(m.getString("btn_sharelink"));$("#btn-createfolder .ui-btn-text").text(m.getString("btn_newdir"));$("#btn-changeuser").hide();$("#btn-select").hide()}
function addtoFavorite(){var a="https://"+g_storage.get("ddns_host_name"),c=isBrowser("msie");if(a==""||a==void 0)a="https://router.asus.com/";if(typeof window.sidebar=="object"&&typeof window.sidebar.addPanel=="function")return window.sidebar.addPanel("AiCloud",a,""),!1;else if(c&&typeof window.external=="object")return window.external.AddFavorite(a,"AiCloud"),!1;else{window.location=a;var a=navigator.userAgent.toLowerCase(),c="",b=a.indexOf("webkit")!=-1,d=a.indexOf("mac")!=-1;if(a.indexOf("konqueror")!=
-1)c="CTRL + B";else if(window.home||b||d)c=(d?"Command/Cmd":"CTRL")+" + D";c=c?m.getString("msg_add_favorite1")+c+m.getString("msg_add_favorite2"):c;alert(c)}}
function getRouterInfo(){client.GETROUTERINFO("/",function(a,c,b){a==200&&(a=parseXml(b),a=$(a),g_storage.set("webdav_mode",a.find("webdav_mode").text()),g_storage.set("http_port",a.find("http_port").text()),g_storage.set("https_port",a.find("https_port").text()),g_storage.set("misc_http_enable",a.find("misc_http_enable").text()),g_storage.set("misc_http_port",String(a.find("misc_http_port").text()).replace("\n","")),g_storage.set("last_login_info",a.find("last_login_info").text()),g_storage.set("ddns_host_name",
a.find("ddns_host_name").text()),g_storage.set("router_version",a.find("version").text()),g_storage.set("aicloud_version",a.find("aicloud_version").text()),a=g_storage.get("last_login_info"),a!=""&&a!=void 0&&(a=String(a).split(">"),a=m.getString("title_logininfo")+a[1]+", "+m.getString("title_ip")+a[2],$("#login_info").text(a)))})}
function createMenu(a,c,b,d){c=$("<div id='"+a+"div'></div>").appendTo("#"+c).show();$("<select id='"+a+"' data-inline='true' data-native-menu='false'></select>").appendTo(c);c=b.split(",");for(b=0;b<c.length;b++)$("<option>"+c[b]+"</option>").appendTo("#"+a);$("#"+a).selectmenu();c=$(".ui-selectmenu");for(b=0;b<c.length;b++)if($(c[b]).children("ul:#"+a+"-menu").length>0){newMenu=$(c[b]);break}if(newMenu==null)alert("Error creating menu");else return $(newMenu).find(".ui-selectmenu-list li a").click(d),
d=$(newMenu).find(".ui-header"),a+="_close_id",d.prepend("<span style='position:relative;float:left'><a href='#' id='"+a+"'>X</href></span>"),$("#"+a).click(function(){newMenu.hide()}),newMenu.hide()}function showMenu(a){if(a!=null){var c=($(window).width()-$(a).width())/2,b=($(window).height()-$(a).height())/2+$(window).scrollTop(),b=c=0;$(a).css({left:c,top:b});$(a).show()}}function menuHandler(a){newMenu!=null&&$(newMenu).hide();alert(a.srcElement.text)}
document.addEventListener("touchmove",function(){},!1);
(function(a){a.widget("mobile.tabbar",a.mobile.navbar,{_create:function(){this.element.addClass("ui-footer ui-footer-fixed ui-bar-"+(this.element.jqmData("theme")||"a"));this.element.closest('[data-role="page"]').addClass("ui-page-footer-fixed");a.mobile.navbar.prototype._create.call(this)},setActive:function(a){this.element.find("a").removeClass("ui-btn-active ui-state-persist");this.element.find('a[href="'+a+'"]').addClass("ui-btn-active ui-state-persist")}});a(document).bind("pagecreate create",
function(c){return a(c.target).find(":jqmData(role='tabbar')").tabbar()});a(document).bind("pageinit",function(){if(!g_bInitialize)a.mobile.selectmenu.prototype.options.nativeMenu=!1,createLayout(),getRouterInfo(),a.mobile.activeBtnClass="unused",g_bInitialize=a.mobile.touchOverflowEnabled=!0});a(":jqmData(role='page')").live("pageshow",function(c){var b,c=a(c.target).attr("id");if(c=="mainpage"){b=g_storage.get("openurl");b=b==void 0?"/":b;var d=a(".ui-listview").attr("path");b!=d&&doPROPFIND(b,
function(){adjustLayout()},0)}b=a.mobile.activePage.find(':jqmData(role="tabbar")');b.length&&b.tabbar("setActive","#"+c)});a("li#list_item").live("click",function(){if(g_select_mode==1){a(this).hasClass("ui-btn-active")?(a(this).removeClass("ui-btn-active"),a(this).removeClass("selected"),a(this).find("#icon").removeClass("checked")):(a(this).addClass("ui-btn-active"),a(this).addClass("selected"),a(this).find("#icon").addClass("checked"));var c=a("li#list_item.selected").size();c>0?(a("#btn-delete").removeClass("ui-disabled"),
a("#btn-share").removeClass("ui-disabled")):(a("#btn-delete").addClass("ui-disabled"),a("#btn-share").addClass("ui-disabled"));c==1?a("#btn-rename").removeClass("ui-disabled"):a("#btn-rename").addClass("ui-disabled")}else a("li#list_item").removeClass("ui-btn-active"),a(this).addClass("ui-btn-active"),openSelItem(a(this))});a("#btnParent").live("click",function(){openSelItem(a(this))});a("a#btn-home").live("click",function(){doPROPFIND("/",function(){a("a#btn-home").removeClass("ui-btn-active")},
0)});a("a#btn-refresh").live("click",function(){var c=g_storage.get("openurl");doPROPFIND(c==void 0?"/":c,function(){a("a#btn-refresh").removeClass("ui-btn-active")},0)});a("a#btn-setting").live("click",function(){openSettingWindow()});a("a#btn-share").live("click",function(){a(this).removeClass("ui-btn-active");m.getString("email_subject");var c="",b="",d="";a("li#list_item.selected").each(function(){var c=a(this).attr("title"),e=a(this).attr("uhref");a(this).attr("isdir");var f=window.location.href;
b=f=e.substring(0,e.lastIndexOf("/"));d+=encodeURI(c);d+=";"});if(d=="")alert("Please select files first.");else{var e=g_storage.get("webdav_mode"),g=g_storage.get("ddns_host_name"),f=g==""?window.location.host:g;f.indexOf(":")!=-1&&(f=f.substring(0,f.indexOf(":")));isPrivateIP(f);f=e==0?"http://"+f+":"+g_storage.get("http_port"):"https://"+f;client.GSL(b,b,d,86400,1,function(b,d,e){if(b==200)if(b=parseXml(e),b=a(b).find("sharelink").text(),b=="")alert("Fail to parse xml!");else{b=b.split(";");d=
b.length;for(e=0;e<d;e++)c+=f+"/"+b[e],e!=d-1&&(c+=";");openShareWindow(c)}})}});a("a#btn-delete").live("click",function(){var c=function(a){a&&a[0]!=2?alert(m.getString(a)+" : "+decodeURI(g_selected_files[0])):(g_selected_files.splice(0,1),g_selected_files.length<=0?(a=addPathSlash(g_storage.get("openurl")),doPROPFIND(a)):client.DELETE(g_selected_files[0],c))};g_selected_files=null;g_selected_files=[];a("li#list_item.selected").each(function(){a(this).attr("uhref");g_selected_files.push(a(this).attr("uhref"))});
g_selected_files.length<=0||confirm(m.getString("del_files_msg"))==!0&&client.DELETE(g_selected_files[0],c)});a("a#btn-rename").live("click",function(){var c=a("li#list_item.selected").attr("title"),b=a("li#list_item.selected").attr("uhref"),d=a("li#list_item.selected").attr("isdir");a("#dialog").remove();var e="";e+="<div data-role='dialog' id='dialog' data-theme='a' data-transition='flip'>";e+="<div data-role='header'>";e+="<h1 id='dialog-title'>"+m.getString("title_rename")+"</h1>";e+="</div>";
e+="<div data-role='content' id='dialog-content'>";e+='<table id="table_content" width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="overflow:hidden;">';e+="<tr>";e+="<td>";e+='<input id="isdir" type="hidden" value="'+d+'"/>';e+='<input id="source" type="hidden" value="'+b+'"/>';e+='<input id="filename" type="text" value="'+c+'"/>';e+="</td>";e+="</tr>";e+="<tr>";e+="<td>";e+='<div class="table_block_footer" style="text-align:right">';e+='<button id="ok" class="btnStyle">'+
m.getString("btn_ok")+"</button>";e+='<button id="cancel" class="btnStyle">'+m.getString("btn_cancel")+"</button>";e+="</div>";e+="</td>";e+="</tr>";e+="</table>";e+="</div>";e+="</div>";a("body").append(e);a("#table_content #ok").click(function(){var b=a("input#source").val(),c=a("input#filename").val(),d=parseInt(a("input#isdir").val());if(c=="")alert(m.getString("blankchar"));else{var e=/[|\/\\?*"<>:`]/g;d==1&&(e=/[|\/\\?*"<>:`.]/g);c.match(e)?alert(m.getString("illegalchar")):(d==1&&b.lastIndexOf("/")==
b.length-1&&(b=b.substring(0,b.length-1)),doRENAME(b,myencodeURI(c)))}});a("#table_content #cancel").click(function(){closeDialog()});openDialog("pop")});a("a#btn-createfolder").live("click",function(){a("#dialog").remove();var c="";c+="<div data-role='dialog' id='dialog' data-theme='a' data-transition='flip'>";c+="<div data-role='header'>";c+="<h1 id='dialog-title'>"+m.getString("title_newdir")+"</h1>";c+="</div>";c+="<div data-role='content' id='dialog-content'>";c+='<table id="table_content" width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="overflow:hidden;">';
c+="<tr>";c+="<td>";c+='<input id="dir_name" type="text" value="'+m.getString("default_dir_name")+'"/>';c+="</td>";c+="</tr>";c+="<tr>";c+="<td>";c+='<div class="table_block_footer" style="text-align:right">';c+='<button id="ok" class="btnStyle">'+m.getString("btn_ok")+"</button>";c+='<button id="cancel" class="btnStyle">'+m.getString("btn_cancel")+"</button>";c+="</div>";c+="</td>";c+="</tr>";c+="</table>";c+="</div>";c+="</div>";a("body").append(c);a("#table_content #ok").click(function(){var b=
a("input#dir_name").val();b==""?alert(m.getString("blankchar")):b.match(/[|~\/\\?*"<>:`.]/g)?alert(m.getString("illegalchar")):doMKDIR(b)});a("#table_content #cancel").click(function(){closeDialog()});openDialog("pop")});a("#btn-select").live("click",function(){g_select_mode==0?(openSelectMode(),a(this).addClass("click")):g_select_mode==1&&(cancelSelectMode(),a(this).removeClass("click"))});a("#btn-changeuser").live("click",function(){if(confirm(m.getString("msg_changeuser_confirm"))==!0){var a=g_storage.get("openurl");
client.LOGOUT(a,function(b){b==200&&doPROPFIND(a)})}});a("div#select").live("click",function(){showMenu(newMenu)});a("#select-choice-custom-button").live("click",function(){g_select_mode==0?openSelectMode():g_select_mode==1&&cancelSelectMode()});a("#btn-logout").live("click",function(){confirm(m.getString("msg_logout_confirm"))==!0&&doLOGOUT()});a(window).resize(adjustLayout)})(jQuery);
